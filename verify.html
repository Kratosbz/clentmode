<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <!-- Verify Email Page -->
    <div id="verifyPage" class="auth-page" >
        <div class="auth-wrapper">
            <div class="auth-card">
                <h2 class="fw-bold text-center mb-2">Verify Your Email</h2>
                <p class="text-muted text-center mb-2">Enter the verification code sent to</p>
                <p class="text-center fw-semibold mb-4" id="verifyEmailDisplay"></p>
                
                <div class="alert alert-success border-0 text-center mb-4" id="verifyCodeSent" style="display: none;">
                    Verification code sent successfully!
                </div>
                
                <form id="verifyForm" onsubmit="handleVerify(event)">
                    <div class="mb-3">
                        <label class="form-label">Verification Code</label>
                        <input type="text" class="form-control text-center py-3 fs-4 fw-bold letter-spacing-wide" id="verificationCode" placeholder="1 8 4 1 8 2" maxlength="6" pattern="[0-9]{6}" required style="letter-spacing: 0.5em;">
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold mb-3" style="background: #5d8df4; border: none;">
                        Verify Email
                    </button>
                    
                    <p class="text-center text-muted mb-0">
                        Didn't receive the code? <a href="#" class="text-primary text-decoration-none" onclick="resendCode()">Resend Code</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    var verifyEmailDisplay=document.getElementById("verifyEmailDisplay")
    verifyEmailDisplay.innerHTML=localStorage.getItem("pendingVerificationEmail")
    async function handleVerify(event) {
        event.preventDefault();
        const code = document.getElementById('verificationCode').value;
        
        try {

var pendingVerificationEmail=localStorage.getItem("pendingVerificationEmail")
    // if (!token) throw new Error('No token found');

            const response = await fetch('https://changes-sample.onrender.com/api/auth/verify-email', {
                method: 'POST',
                 headers: {
        'Content-Type': 'application/json',
        // ✅ Send JWT
      },
                body: JSON.stringify({ email: pendingVerificationEmail, code })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Verification failed', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            Swal.fire({ icon: 'success', title: 'Success', text: 'Email verified successfully! Welcome to Ethergalleries.', confirmButtonColor: '#5d8df4' });
            location.href="./login.html"
            // showDashboard();
            // loadDashboardStats();
        } catch (err) {
            console.error('Verify error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to verify email. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    async function resendCode() {
        try {
// const token = localStorage.getItem('token'); 
var pendingVerificationEmail=localStorage.getItem("pendingVerificationEmail")

    // if (!token) throw new Error('No token found');

            const response = await fetch('https://changes-sample.onrender.com/api/auth/resend-code', {
                method: 'POST',
                 headers: {
        'Content-Type': 'application/json',
         // ✅ Send JWT
      },
                body: JSON.stringify({ email: pendingVerificationEmail })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Failed to resend code', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            document.getElementById('verifyCodeSent').style.display = 'block';
            setTimeout(() => {
                document.getElementById('verifyCodeSent').style.display = 'none';
            }, 3000);
        } catch (err) {
            console.error('Resend error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to resend code. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
</script>
</body>
</html>