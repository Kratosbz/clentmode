<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaultorx Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --vx-blue: #0d6efd;
            --vx-bg: #f8f9fa;
            --vx-card-border: rgba(0,0,0,0.08);
            --sidebar-width: 280px;
        }
        body {
            background-color: var(--vx-bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #1a1a1a;
            overflow-x: hidden;
        }
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: white;
            border-right: 1px solid var(--vx-card-border);
            z-index: 1100;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        .sidebar-logo {
            padding: 2rem 1.5rem;
        }
        .sidebar-logo h2 {
            display: flex;
            align-items: center;
        }
        .sidebar-nav {
            flex: 1;
            padding: 0 1rem;
            overflow-y: auto;
        }
        .nav-section-label {
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            color: #1a1a1a;
            text-decoration: none;
            border-radius: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
        }
        .sidebar-link:hover {
            background: #f8f9fa;
            color: var(--vx-blue);
        }
        .sidebar-link.active {
            background: #f0f7ff;
            color: var(--vx-blue);
        }
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid var(--vx-card-border);
        }
        
        /* Main Content Adjustments */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
        }
        header {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--vx-card-border);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        @media (max-width: 991.98px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .sidebar-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1050;
            }
            .sidebar-overlay.show {
                display: block;
            }
        }

        .vx-card {
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 1.25rem;
            padding: 1.5rem;
            height: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .vx-card:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        .balance-card {
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 1.5rem;
            padding: 2rem;
        }
        .quick-action-btn {
            background: #f0f7ff;
            border: none;
            border-radius: 1.25rem;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            color: #0d6efd;
            font-weight: 600;
            width: 100%;
            height: 100%;
            min-height: 140px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .quick-action-btn:hover {
            background: white;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .quick-action-btn i {
            font-size: 1.75rem;
        }
        .nav-pills-custom .nav-link {
            color: #6c757d;
            border-radius: 0.75rem;
            font-weight: 500;
            padding: 0.5rem 1.25rem;
        }
        .view-options-panel {
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 1.25rem;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
            flex-direction: column;
            gap: 0.75rem;
        }
        .view-option-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid var(--vx-card-border);
            background: #f8f9fa;
            text-align: left;
            font-weight: 500;
            color: #1a1a1a;
            transition: all 0.2s;
        }
        .view-option-btn.active {
            background: #5d8df4;
            color: white;
            border-color: #5d8df4;
        }
        .toggle-group-custom {
            display: flex;
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 0.75rem;
            overflow: hidden;
        }
        .toggle-group-item {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: white;
            color: #6c757d;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toggle-group-item.active {
            background: #5d8df4;
            color: white;
        }
        .create-btn-sm {
            background: #5d8df4;
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 0.5rem 1.25rem;
            font-weight: 600;
            width: fit-content;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        /* Modal Styles */
        .vx-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: flex-end;
            justify-content: center;
            overflow-y: auto;
        }
        
        /* Ensure SweetAlert appears above all modals */
        .swal2-container {
            z-index: 3000 !important;
        }
        @media (min-width: 992px) {
            .vx-modal-overlay {
                align-items: center;
                padding: 2rem;
            }
        }
        .vx-modal-body {
            max-height: 60vh;
            overflow-y: auto;
        }
        .vx-modal {
            background: white;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            border-radius: 1.5rem 1.5rem 0 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }
        @media (min-width: 992px) {
            .vx-modal {
                border-radius: 1.5rem;
            }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .vx-modal-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: 1px solid var(--vx-card-border);
        }
        .vx-modal-close {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6c757d;
        }
        .vx-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }
        .upload-zone {
            border: 2px dashed var(--vx-card-border);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .upload-zone:hover {
            border-color: #5d8df4;
        }
        .form-label-custom {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        .form-control-custom {
            background: #f8f9fa;
            border: 1px solid var(--vx-card-border);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            width: 100%;
            margin-bottom: 1.25rem;
        }
        .form-control-custom:focus {
            outline: none;
            border-color: #5d8df4;
            background: white;
        }
        .royalty-slider {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            appearance: none;
            margin-bottom: 0.5rem;
        }
        .royalty-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid #5d8df4;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .vx-modal-footer {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            border-top: 1px solid var(--vx-card-border);
        }
        /* Settings Page Styles */
        .settings-menu-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .settings-menu-btn:hover {
            background: #f8f9fa;
        }
        .settings-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid var(--vx-card-border);
            border-radius: 0.75rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            min-width: 220px;
            z-index: 1000;
            display: none;
        }
        .settings-dropdown.show {
            display: block;
        }
        .settings-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #1a1a1a;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .settings-dropdown-item:hover {
            background: #f8f9fa;
        }
        .settings-dropdown-item.active {
            background: #f0f7ff;
            color: #5d8df4;
        }
        .settings-dropdown-item:first-child {
            border-radius: 0.75rem 0.75rem 0 0;
        }
        .settings-dropdown-item:last-child {
            border-radius: 0 0 0.75rem 0.75rem;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #e0e0e0;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.active {
            background: #5d8df4;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.active::after {
            transform: translateX(24px);
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            color: #666;
            position: relative;
        }
        .profile-avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 28px;
            height: 28px;
            background: #5d8df4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .settings-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: border-color 0.2s;
            background: #fafafa;
        }
        .settings-input:focus {
            outline: none;
            border-color: #5d8df4;
            background: white;
        }
        .settings-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
        }
        .password-input-wrapper {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
        }
        .verified-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-section-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: #666;
            margin: 1.5rem 0 1rem 0;
        }
        /* Minting Wizard Styles */
        .mint-modal {
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .mint-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
        }
        .mint-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        .mint-step.active .step-circle,
        .mint-step.completed .step-circle {
            background: #5d8df4;
            color: white;
        }
        .mint-step.completed .step-circle::after {
            content: '\2713';
        }
        .mint-step.completed .step-circle {
            font-size: 0;
        }
        .mint-step.completed .step-circle::after {
            font-size: 0.85rem;
        }
        .step-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
        }
        .mint-step.active .step-label,
        .mint-step.completed .step-label {
            color: #5d8df4;
        }
        .step-line {
            flex: 1;
            height: 2px;
            background: #e0e0e0;
            margin: 0 0.5rem;
            margin-bottom: 1.5rem;
            max-width: 40px;
        }
        .mint-step-content {
            display: none;
        }
        .mint-step-content.active {
            display: block;
        }
        .media-type-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.75rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 80px;
        }
        .media-type-btn:hover {
            border-color: #5d8df4;
        }
        .media-type-btn.active {
            border-color: #5d8df4;
            background: #f0f7ff;
            color: #5d8df4;
        }
        .media-type-btn i {
            font-size: 1.5rem;
        }
        .media-type-btn span {
            font-size: 0.85rem;
            font-weight: 500;
        }
        .mint-upload-zone {
            border: 2px dashed #e0e0e0;
            border-radius: 0.75rem;
            padding: 2.5rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #fafafa;
        }
        .mint-upload-zone:hover,
        .mint-upload-zone.dragover {
            border-color: #5d8df4;
            background: #f0f7ff;
        }
        .mint-upload-zone.has-file {
            border-style: solid;
            border-color: #5d8df4;
        }
        .upload-preview img,
        .upload-preview video {
            max-width: 200px;
            max-height: 200px;
            border-radius: 0.5rem;
            object-fit: cover;
        }
        .upload-preview .audio-preview {
            width: 100%;
            max-width: 300px;
        }
        .rarity-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        .rarity-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .rarity-option:hover {
            border-color: #5d8df4;
        }
        .rarity-option.active {
            border-color: #5d8df4;
            background: #f0f7ff;
        }
        .rarity-option input {
            display: none;
        }
        .rarity-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            position: relative;
        }
        .rarity-option.active .rarity-dot {
            border-color: #5d8df4;
        }
        .rarity-option.active .rarity-dot::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #5d8df4;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .attribute-row {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .attribute-row input {
            flex: 1;
        }
        .list-immediately-option {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.75rem;
            cursor: pointer;
        }
        .list-immediately-option input {
            display: none;
        }
        .list-immediately-option .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .list-immediately-option input:checked + .checkmark {
            background: #5d8df4;
            border-color: #5d8df4;
        }
        .list-immediately-option input:checked + .checkmark::after {
            content: '\2713';
            color: white;
            font-size: 0.75rem;
        }
        .sale-type-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .sale-type-option {
            display: block;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sale-type-option:hover {
            border-color: #5d8df4;
        }
        .sale-type-option.active {
            border-color: #5d8df4;
            background: #f0f7ff;
        }
        .sale-type-option input {
            display: none;
        }
        .sale-type-content {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        .sale-type-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            flex-shrink: 0;
            margin-top: 2px;
            position: relative;
        }
        .sale-type-option.active .sale-type-dot {
            border-color: #5d8df4;
        }
        .sale-type-option.active .sale-type-dot::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: #5d8df4;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .review-preview {
            text-align: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 0.75rem;
        }
        .preview-media {
            width: 150px;
            height: 150px;
            background: #e9ecef;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            overflow: hidden;
        }
        .preview-media i {
            font-size: 3rem;
            color: #adb5bd;
        }
        .preview-media img,
        .preview-media video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .review-details {
            background: #f8f9fa;
            border-radius: 0.75rem;
            padding: 1rem;
        }
        .review-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        .review-row:last-child {
            border-bottom: none;
        }
        .review-row span:first-child {
            color: #666;
        }
        .review-row span:last-child {
            font-weight: 500;
        }
        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.75rem;
            cursor: pointer;
        }
        .terms-checkbox input {
            display: none;
        }
        .terms-checkbox .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .terms-checkbox input:checked + .checkmark {
            background: #5d8df4;
            border-color: #5d8df4;
        }
        .terms-checkbox input:checked + .checkmark::after {
            content: '\2713';
            color: white;
            font-size: 0.75rem;
        }
        
        /* Auth Pages Styles */
        .auth-page {
            min-height: 100vh;
            background: #f8f9fa;
            padding: 2rem 1rem;
        }
        .auth-wrapper {
            max-width: 420px;
            margin: 0 auto;
            padding-top: 2rem;
        }
        .auth-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .auth-card .input-group-text {
            border-radius: 0.5rem 0 0 0.5rem;
        }
        .auth-card .form-control {
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .auth-card .input-group-text:last-child {
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .auth-card .form-control:not(:last-child) {
            border-radius: 0;
        }
    </style>
</head>
<body>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
        <h2 class="h4 fw-bold text-primary mb-0"><i class="bi bi-compass me-2"></i>VAULTORX</h2>
    </div>
    <div class="sidebar-nav">
        <div class="nav-section-label">Navigation</div>
        <a href="#" class="sidebar-link active" onclick="showPage('dashboard')">
            <i class="bi bi-grid-fill"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('collection')">
            <i class="bi bi-folder"></i>
            <span>Collection</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('nfts')">
            <i class="bi bi-gem"></i>
            <span>My NFTs</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('transactions')">
            <i class="bi bi-card-list"></i>
            <span>Transactions</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('sales')">
            <i class="bi bi-graph-up"></i>
            <span>Sales</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('exhibitions')">
            <i class="bi bi-image"></i>
            <span>Exhibitions</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('auctions')">
            <i class="bi bi-hammer"></i>
            <span>Auctions</span>
        </a>
        <a href="#" class="sidebar-link" onclick="showPage('settings')">
            <i class="bi bi-gear"></i>
            <span>Settings</span>
        </a>
        <!-- <a href="#" class="sidebar-link">
            <i class="bi bi-shield-check"></i>
            <span>Privacy Policy</span>
        </a>
        <a href="#" class="sidebar-link">
            <i class="bi bi-file-text"></i>
            <span>Terms Of Service</span>
        </a> -->
    </div>
    <div class="sidebar-footer">
        <a href="#" class="sidebar-link text-danger" onclick="logout()">
            <i class="bi bi-box-arrow-left"></i>
            <span>Sign Out</span>
        </a>
    </div>
</aside>

<!-- Auth Pages Container -->
<div id="authContainer" style="display: none;">
    <!-- Login Page -->
    <div id="loginPage" class="auth-page" style="display: none;">
        <div class="auth-wrapper">
            <button class="btn btn-link text-decoration-none p-0 mb-4" onclick="window.location.href='/'">
                <i class="bi bi-arrow-left me-2"></i> Back
            </button>
            <div class="auth-card">
                <h2 class="fw-bold text-center mb-2">Sign in to your account</h2>
                <p class="text-muted text-center mb-4">Access your NFT marketplace account</p>
                
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-envelope text-muted"></i>
                            </span>
                            <input type="email" class="form-control border-start-0 ps-0" id="loginEmail" placeholder="Email address" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-lock text-muted"></i>
                            </span>
                            <input type="password" class="form-control border-start-0 border-end-0 ps-0" id="loginPassword" placeholder="Password" required>
                            <button type="button" class="input-group-text bg-white border-start-0" onclick="togglePasswordVisibility('loginPassword', this)">
                                <i class="bi bi-eye text-muted"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-4 gap-2 flex-wrap">
                        <label class="form-check-label d-flex align-items-center gap-2">
                            <input type="checkbox" class="form-check-input m-0" id="rememberMe">
                            Remember me
                        </label>
                        <a href="forgot-password.html" class="text-primary text-decoration-none small">Forgot your password?</a>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold mb-3" style="background: #5d8df4; border: none;">
                        Sign in
                    </button>
                    
                    <p class="text-center text-muted mb-0">
                        Don't have an account? <a href="#" class="text-primary text-decoration-none" onclick="showAuthPage('signup')">Sign up</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Signup Page -->
    <div id="signupPage" class="auth-page" style="display: none;">
        <div class="auth-wrapper">
            <button class="btn btn-link text-decoration-none p-0 mb-4" onclick="showAuthPage('login')">
                <i class="bi bi-arrow-left me-2"></i> Back
            </button>
            <div class="auth-card">
                <h2 class="fw-bold text-center mb-2">Create your account</h2>
                <p class="text-muted text-center mb-4">Join the NFT marketplace community</p>
                
                <form id="signupForm" onsubmit="handleSignup(event)">
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-person text-muted"></i>
                            </span>
                            <input type="text" class="form-control border-start-0 ps-0" id="signupUsername" placeholder="Username">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-envelope text-muted"></i>
                            </span>
                            <input type="email" class="form-control border-start-0 ps-0" id="signupEmail" placeholder="Email address" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-lock text-muted"></i>
                            </span>
                            <input type="password" class="form-control border-start-0 border-end-0 ps-0" id="signupPassword" placeholder="Password" required minlength="6">
                            <button type="button" class="input-group-text bg-white border-start-0" onclick="togglePasswordVisibility('signupPassword', this)">
                                <i class="bi bi-eye text-muted"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-lock text-muted"></i>
                            </span>
                            <input type="password" class="form-control border-start-0 border-end-0 ps-0" id="signupConfirmPassword" placeholder="Confirm Password" required>
                            <button type="button" class="input-group-text bg-white border-start-0" onclick="togglePasswordVisibility('signupConfirmPassword', this)">
                                <i class="bi bi-eye text-muted"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold mb-3" style="background: #5d8df4; border: none;">
                        Create Account
                    </button>
                    
                    <p class="text-center text-muted mb-0">
                        Already have an account? <a href="#" class="text-primary text-decoration-none" onclick="showAuthPage('login')">Sign in</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Verify Email Page -->
    <div id="verifyPage" class="auth-page" style="display: none;">
        <div class="auth-wrapper">
            <div class="auth-card">
                <h2 class="fw-bold text-center mb-2">Verify Your Email</h2>
                <p class="text-muted text-center mb-2">Enter the verification code sent to</p>
                <p class="text-center fw-semibold mb-4" id="verifyEmailDisplay">user@example.com</p>
                
                <div class="alert alert-success border-0 text-center mb-4" id="verifyCodeSent" style="display: none;">
                    Verification code sent successfully!
                </div>
                
                <form id="verifyForm" onsubmit="handleVerify(event)">
                    <div class="mb-3">
                        <label class="form-label">Verification Code</label>
                        <input type="text" class="form-control text-center py-3 fs-4 fw-bold letter-spacing-wide" id="verificationCode" placeholder="1 8 4 1 8 2" maxlength="6" pattern="[0-9]{6}" required style="letter-spacing: 0.5em;">
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold mb-3" style="background: #5d8df4; border: none;">
                        Verify Email
                    </button>
                    
                    <p class="text-center text-muted mb-0">
                        Didn't receive the code? <a href="#" class="text-primary text-decoration-none" onclick="resendCode()">Resend Code</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="main-content">
    <header class="py-3">
        <div class="container-fluid px-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-light d-lg-none" id="sidebarToggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <div>
                        <h1 class="h3 fw-bold mb-0" id="pageTitle">Dashboard</h1>
                    </div>
                </div>
                <div class="icon-circle bg-primary text-white fw-bold">VX</div>
            </div>
        </div>
    </header>

    <div id="dashboardPage">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <!-- Balance Section -->
            <div class="balance-card mb-4 d-flex justify-content-between align-items-center">
                <div>
                    <p class="text-muted small mb-1">Account Balance</p>
                    <h2 class="display-6 fw-bold mb-1" id="totalBalanceUSD">$0.00</h2>
                    <p class="text-muted small mb-0"><span id="totalBalanceETH">0.0000</span> Total (ETH + WETH)</p>
                </div>
                <div class="icon-circle bg-primary bg-opacity-10 text-primary">
                    <i class="bi bi-wallet2"></i>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="row g-3 mb-5">
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">ETH Balance</span>
                            <div class="icon-circle bg-info bg-opacity-10 text-info" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-currency-bitcoin"></i>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-0" id="ethBalanceDisplay">0.0000</h5>
                        <span class="text-muted small">Ethereum</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">WETH Balance</span>
                            <div class="icon-circle bg-danger bg-opacity-10 text-danger" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-layers"></i>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-0" id="wethBalanceDisplay">0.0000</h5>
                        <span class="text-muted small">Wrapped ETH</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Total NFTs</span>
                            <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-bag"></i>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-0" id="statTotalNfts">0</h5>
                        <span class="text-muted small">NFTs</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Active Listings</span>
                            <div class="icon-circle bg-warning bg-opacity-10 text-warning" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-activity"></i>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-0" id="statListedNfts">0</h5>
                        <span class="text-muted small">Listed</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="mb-5">
                <h4 class="fw-bold mb-4">Quick Actions</h4>
                <div class="row g-3">
                    <div class="col-6 col-md-3">
                        <button class="quick-action-btn" onclick="openDepositModal()">
                            <i class="bi bi-upload"></i>
                            <span>Deposit</span>
                        </button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="quick-action-btn" onclick="openWithdrawModal()" style="color: #fd7e14; background: #fff8f0;">
                            <i class="bi bi-download"></i>
                            <span>Withdraw</span>
                        </button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="quick-action-btn" style="color: #198754; background: #f0fff4;" onclick="openMintModal()">
                            <i class="bi bi-plus-lg"></i>
                            <span>Mint NFT</span>
                        </button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="quick-action-btn" style="color: #6f42c1; background: #f5f0ff;" onclick="openConvertModal()">
                            <i class="bi bi-arrow-left-right"></i>
                            <span>Convert</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="mb-5">
                <h4 class="fw-bold mb-4">Recent Activity</h4>
                <div id="dashboardTransactions" class="vx-card text-center py-5">
                    <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                        <i class="bi bi-clock-history text-muted"></i>
                    </div>
                    <h5 class="fw-bold">No recent activity</h5>
                    <p class="text-muted mb-4">Your transactions will appear here</p>
                    <button class="btn btn-outline-primary px-4 rounded-pill">Explore Marketplace</button>
                </div>
            </div>

            <!-- My NFTs -->
            <div class="mb-5">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
                    <h4 class="fw-bold mb-0">My NFTs</h4>
                    <div class="d-flex align-items-center gap-2">
                        <ul class="nav nav-pills nav-pills-custom bg-light p-1 rounded-pill" id="dashboardNftTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active rounded-pill" onclick="filterDashboardNfts('listed', this)" type="button">Listed (<span id="listedCount">0</span>)</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill" onclick="filterDashboardNfts('unlisted', this)" type="button">Unlisted (<span id="unlistedCount">0</span>)</button>
                            </li>
                        </ul>
                        <a href="#" onclick="showPage('nfts')" class="btn btn-sm btn-outline-primary rounded-pill">View All</a>
                    </div>
                </div>
                <div id="dashboardNftsGrid" class="row g-3">
                    <div class="col-12">
                        <div class="vx-card text-center py-5">
                            <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                <i class="bi bi-search text-muted"></i>
                            </div>
                            <h5 class="fw-bold">You don't own any NFTs yet</h5>
                            <p class="text-muted mb-4">Start building your collection today</p>
                            <button class="btn btn-primary px-4 py-2 rounded-pill shadow-sm" onclick="openMintModal()">Mint Your First NFT</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="collectionPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="mb-4">
                <h2 class="h3 fw-bold mb-1">My Collection</h2>
                <p class="text-muted small">Manage and view your NFT collections and individual assets</p>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total Collections</span>
                            <div class="icon-circle bg-primary bg-opacity-10 text-primary" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-grid-3x3-gap"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="totalCollections" >0</h4>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total NFTs</span>
                            <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-list-ul"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="totalNftsInside">0</h4>
                    </div>
                </div>
                <!-- <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Floor Value</span>
                            <div class="icon-circle bg-info bg-opacity-10 text-info" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-eye"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="floorValue">0.00 WETH</h4>
                    </div>
                </div> -->
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total Volume</span>
                            <div class="icon-circle bg-purple bg-opacity-10 text-purple" style="width: 32px; height: 32px; font-size: 1rem; color: #6f42c1;">
                                <i class="bi bi-share"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="totalCollectionVolume">0.0 WETH</h4>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <button class="btn btn-light w-100 py-2 border rounded-3 d-flex align-items-center justify-content-center gap-2" onclick="toggleViewOptions()">
                    <i class="bi bi-text-left"></i>
                    View Options
                </button>
                
                <div class="view-options-panel" id="viewOptionsPanel">
                    <button class="view-option-btn active">Collections</button>
                    <button class="view-option-btn">All NFTs</button>
                    
                    <div class="toggle-group-custom">
                        <button class="toggle-group-item active">
                            <i class="bi bi-grid-3x3-gap"></i>
                        </button>
                        <button class="toggle-group-item">
                            <i class="bi bi-list-ul"></i>
                        </button>
                    </div>
                    
                    <button class="create-btn-sm" onclick="openCreateModal()">
                        <i class="bi bi-plus"></i>
                        Create
                    </button>
                </div>
            </div>

            <div class="row g-3" id="collectionsGrid">
                <div class="col-12 text-center py-5">
                    <i class="bi bi-folder-x text-muted display-4 mb-3 d-block"></i>
                    <h5 class="fw-bold mb-2">No collections yet</h5>
                    <p class="text-muted mb-3">Create your first collection to start adding NFTs</p>
                    <button class="btn btn-primary rounded-3 px-4" onclick="openCreateModal()" style="background: #5d8df4; border: none;">
                        <i class="bi bi-plus-lg me-2"></i>Create Collection
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div id="transactionsPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="mb-4">
                <h2 class="h3 fw-bold mb-1">Transactions</h2>
                <p class="text-muted small">View your complete transaction history including NFT trades, transfers, and platform fees</p>
            </div>

            <div class="vx-card mb-4">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <p class="text-muted small mb-0">Total Volume</p>
                    <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 24px; height: 24px; font-size: 0.8rem;">
                        <i class="bi bi-wallet2"></i>
                    </div>
                </div>
                <h3 class="fw-bold mb-0" id="totalTransacVolume">...</h3>
            </div>

            <div class="vx-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="fw-bold mb-0">Transaction History</h5>
                    <button class="btn btn-light btn-sm border d-flex align-items-center gap-2 px-3 py-2 rounded-3">
                        <i class="bi bi-filter-left"></i>
                        Filters
                    </button>
                </div>
                <p class="text-muted small mb-4">All your transactions including NFT trades, transfers, and fees</p>

                <div class="d-flex gap-2 mb-4 overflow-auto pb-2" id="transactionTabs">
                    <button class="btn btn-light btn-sm border rounded-3 px-3 active" onclick="filterTransactions('all', this)">All</button>
                    <button class="btn btn-light btn-sm border rounded-3 px-3" onclick="filterTransactions('buy', this)">Buys</button>
                    <button class="btn btn-light btn-sm border rounded-3 px-3" onclick="filterTransactions('sold', this)">Sales</button>
                    <button class="btn btn-light btn-sm border rounded-3 px-3" onclick="filterTransactions('conversion', this)">Conversions</button>
                    <button class="btn btn-light btn-sm border rounded-3 px-3" onclick="filterTransactions('other', this)">Other</button>
                </div>

                <div id="transactionsList" class="vx-card text-center py-5 border-dashed" style="border-style: dashed !important; background: transparent;">
                    <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                        <i class="bi bi-coin text-muted"></i>
                    </div>
                    <h5 class="fw-bold">No transactions found</h5>
                    <p class="text-muted mb-0">Try adjusting your search or filters</p>
                </div>
            </div>
        </main>
    </div>

    <div id="salesPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <h2 class="h3 fw-bold mb-1">Sales Listings</h2>
                    <p class="text-muted small">Manage your NFT listings on the marketplace</p>
                </div>
                <button class="btn btn-primary rounded-3 px-4 py-2 d-flex align-items-center gap-2" style="background: #5d8df4; border: none;" onclick="openListNFTModal()">
                    <i class="bi bi-plus-lg"></i>
                    List New NFT
                </button>
            </div>

            <div class="vx-card mb-4">
                <div class="mb-3">
                    <div class="input-group border rounded-3 overflow-hidden bg-light">
                        <span class="input-group-text border-0 bg-transparent text-muted">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="text" class="form-control border-0 bg-transparent py-2" placeholder="Search by NFT name or collection.">
                    </div>
                </div>
                <div class="dropdown">
                    <button class="btn btn-light border rounded-3 px-3 py-2 d-flex align-items-center gap-2" type="button">
                        <i class="bi bi-filter"></i>
                        All Stat
                        <i class="bi bi-chevron-down small ms-2"></i>
                    </button>
                </div>
            </div>

            <div class="vx-card">
                <h5 class="fw-bold mb-1">Your Listings</h5>
                <p class="text-muted small mb-4" id="salesCount">0 listings found</p>

                <div id="salesList">
                    <div class="text-center py-5">
                        <i class="bi bi-image text-muted display-4 mb-3 d-block"></i>
                        <h5 class="fw-bold mb-2">No listings yet</h5>
                        <p class="text-muted mb-0">You haven't listed any NFTs yet.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="auctionsPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="mb-4">
                <h2 class="h3 fw-bold mb-1">Auctions</h2>
                <p class="text-muted small">Manage your NFT auctions and bidding activity</p>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Created Auctions</span>
                            <div class="icon-circle bg-primary bg-opacity-10 text-primary" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-award"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="auctionStatCreated">0</h4>
                        <span class="text-success small">0% success</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Total Bids</span>
                            <div class="icon-circle bg-purple bg-opacity-10 text-purple" style="width: 24px; height: 24px; font-size: 0.8rem; color: #6f42c1;">
                                <i class="bi bi-record-circle"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="auctionStatBids">0</h4>
                        <span class="text-success small">0% won</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Total Volume</span>
                            <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-graph-up-arrow"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="auctionStatVolume">0.0 WETH</h4>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted small">Active Activity</span>
                            <div class="icon-circle bg-warning bg-opacity-10 text-warning" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-people"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="auctionStatActive">0</h4>
                        <span class="text-muted small">0 auctions, 0 bids</span>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <button class="btn btn-light w-100 py-2 border rounded-3 d-flex align-items-center justify-content-center gap-2 mb-3">
                    <i class="bi bi-filter-left"></i>
                    Filter Auctions
                </button>
                <button class="btn btn-primary rounded-3 px-4 py-2 d-flex align-items-center gap-2" style="background: #5d8df4; border: none;" onclick="openCreateAuctionModal()">
                    <i class="bi bi-plus-lg"></i>
                    Create Auction
                </button>
            </div>

            <div id="auctionsList" class="vx-card text-center py-5">
                <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                    <i class="bi bi-hammer text-muted"></i>
                </div>
                <h5 class="fw-bold">No auctions found</h5>
                <p class="text-muted mb-0">You don't have any live auctions right now.</p>
            </div>
        </main>
    </div>

    <div id="exhibitionsPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="mb-4">
                <h2 class="h3 fw-bold mb-1">Exhibitions</h2>
                <p class="text-muted small">Create and manage your NFT exhibitions and showcases</p>
            </div>

            <button class="btn btn-primary w-100 rounded-3 py-2 mb-4 fw-bold" style="background: #5d8df4; border: none;" onclick="openCreateExhibitionModal()">
                <i class="bi bi-plus-lg me-2"></i>
                Create Exhibition
            </button>

            <div class="row g-3 mb-4">
                <div class="col-6">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total</span>
                            <div class="icon-circle bg-primary bg-opacity-10 text-primary" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-image"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="exhibitionStatTotal">0</h4>
                    </div>
                </div>
                <div class="col-6">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Active</span>
                            <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-check-circle"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="exhibitionStatActive">0</h4>
                    </div>
                </div>
                <div class="col-6">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total Views</span>
                            <div class="icon-circle bg-purple bg-opacity-10 text-purple" style="width: 24px; height: 24px; font-size: 0.8rem; color: #6f42c1;">
                                <i class="bi bi-eye"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="exhibitionStatViews">0</h4>
                    </div>
                </div>
                <div class="col-6">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total Likes</span>
                            <div class="icon-circle bg-danger bg-opacity-10 text-danger" style="width: 24px; height: 24px; font-size: 0.8rem;">
                                <i class="bi bi-heart"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="exhibitionStatLikes">0</h4>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <button class="btn btn-light w-100 py-2 border rounded-3 d-flex align-items-center justify-content-center gap-2">
                    <i class="bi bi-filter-left"></i>
                    Filter Exhibitions
                </button>
            </div>

            <p class="text-muted small mb-3" id="exhibitionsCount">0 exhibitions</p>
            <div id="exhibitionsList" class="vx-card text-center py-5 border-dashed" style="border-style: dashed !important; background: transparent; min-height: 200px;">
            </div>
        </main>
    </div>

    <!-- NFTs Page -->
    <div id="nftsPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 1200px; margin: 0 auto;">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
                <div>
                    <h2 class="h3 fw-bold mb-1">My NFTs</h2>
                    <p class="text-muted small mb-0">View and manage all your NFTs</p>
                </div>
                <button class="btn btn-primary rounded-3 px-4" onclick="openMintModal()" style="background: #5d8df4; border: none;">
                    <i class="bi bi-plus-lg me-2"></i>Mint NFT
                </button>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total NFTs</span>
                            <div class="icon-circle bg-primary bg-opacity-10 text-primary" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-gem"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="nftsPageTotal">0</h4>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Listed</span>
                            <div class="icon-circle bg-success bg-opacity-10 text-success" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-tag"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="nftsPageListed">0</h4>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">In Auctions</span>
                            <div class="icon-circle bg-warning bg-opacity-10 text-warning" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-hammer"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="nftsPageAuctions">0</h4>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="vx-card d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Total Value</span>
                            <div class="icon-circle bg-info bg-opacity-10 text-info" style="width: 32px; height: 32px; font-size: 1rem;">
                                <i class="bi bi-currency-dollar"></i>
                            </div>
                        </div>
                        <h4 class="fw-bold mb-0" id="nftsPageValue">0 ETH</h4>
                    </div>
                </div>
            </div>

            <ul class="nav nav-pills nav-pills-custom bg-light p-1 rounded-pill mb-4" id="nftPageTabs" style="width: fit-content;">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active rounded-pill" onclick="filterNftsPage('listed', this)" type="button">Listed</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link rounded-pill" onclick="filterNftsPage('owned', this)" type="button">Unlisted</button>
                </li>
            </ul>

            <div id="nftsPageGrid" class="row g-3">
                <div class="col-12">
                    <div class="vx-card text-center py-5">
                        <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-gem text-muted"></i>
                        </div>
                        <h5 class="fw-bold">No NFTs found</h5>
                        <p class="text-muted mb-4">Start by minting your first NFT</p>
                        <button class="btn btn-primary px-4 py-2 rounded-pill shadow-sm" onclick="openMintModal()">Mint NFT</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" style="display: none;">
        <main class="container-fluid px-4 py-4" style="max-width: 600px; margin: 0 auto;">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <h2 class="h3 fw-bold mb-1">Account Settings</h2>
                    <p class="text-muted small mb-0">Manage your account settings and preferences</p>
                </div>
                <div class="position-relative">
                    <button class="settings-menu-btn" onclick="toggleSettingsMenu()" data-testid="button-settings-menu">
                        <i class="bi bi-list"></i>
                        Menu
                    </button>
                    <div class="settings-dropdown" id="settingsDropdown">
                        <div class="settings-dropdown-item active" onclick="switchSettingsSection('account')" data-testid="menu-account-settings">
                            <i class="bi bi-person"></i>
                            Account Settings
                        </div>
                        <div class="settings-dropdown-item" onclick="switchSettingsSection('password')" data-testid="menu-change-password">
                            <i class="bi bi-key"></i>
                            Change Password
                        </div>
                        <div class="settings-dropdown-item" onclick="switchSettingsSection('notifications')" data-testid="menu-notifications">
                            <i class="bi bi-bell"></i>
                            Notification Preferences
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Settings Section -->
            <div id="accountSettingsSection" class="vx-card">
                <h5 class="fw-bold mb-1">Profile Information</h5>
                <p class="text-muted small mb-4">Update your account profile information</p>
                
                <div class="d-flex align-items-start gap-3 mb-4">
                    <div class="profile-avatar" id="profileAvatarDisplay">
                        J
                        <label for="profileImageUpload" class="profile-avatar-upload">
                            <i class="bi bi-camera"></i>
                        </label>
                        <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(this)">
                    </div>
                    <div>
                        <h6 class="fw-bold mb-1">Profile Picture</h6>
                        <p class="text-muted small mb-2">Click the camera icon to upload a new photo</p>
                        <button class="btn btn-sm btn-outline-secondary rounded-pill" onclick="shareProfile()" data-testid="button-share-profile">
                            <i class="bi bi-share me-1"></i>
                            Share Profile
                        </button>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="settings-label">Full Name</label>
                    <input type="text" class="settings-input" id="settingsFullName" placeholder="Enter your full name" data-testid="input-full-name">
                </div>

                <div class="mb-3">
                    <label class="settings-label">Username</label>
                    <input type="text" class="settings-input" id="settingsUsername" placeholder="Enter your username" data-testid="input-username">
                    <p class="text-muted small mt-1">This will be your public profile URL: /user/<span id="usernamePreview">username</span></p>
                </div>

                <div class="mb-3">
                    <label class="settings-label">Bio</label>
                    <textarea class="settings-input" id="settingsBio" rows="3" placeholder="Tell people about yourself..." data-testid="input-bio"></textarea>
                </div>

                <div class="mb-3">
                    <label class="settings-label"><i class="bi bi-globe"></i> Website</label>
                    <input type="url" class="settings-input" id="settingsWebsite" placeholder="https://yourwebsite.com" data-testid="input-website">
                </div>

                <div class="mb-3">
                    <label class="settings-label"><i class="bi bi-twitter"></i> Twitter</label>
                    <input type="text" class="settings-input" id="settingsTwitter" placeholder="yourusername" data-testid="input-twitter">
                </div>

                <div class="mb-3">
                    <label class="settings-label"><i class="bi bi-instagram"></i> Instagram</label>
                    <input type="text" class="settings-input" id="settingsInstagram" placeholder="yourusername" data-testid="input-instagram">
                </div>

                <div class="mb-4">
                    <label class="settings-label">Email Address</label>
                    <input type="email" class="settings-input" id="settingsEmail" placeholder="your@email.com" data-testid="input-email">
                    <div class="verified-badge mt-2">
                        <i class="bi bi-check-circle"></i>
                        Verified
                    </div>
                </div>

                <button class="btn btn-primary w-100 py-2 rounded-3 fw-bold" style="background: #5d8df4; border: none;" onclick="saveAccountSettings()" data-testid="button-save-settings">
                    <i class="bi bi-save me-2"></i>
                    Save Changes
                </button>
            </div>

            <!-- Change Password Section -->
            <div id="changePasswordSection" class="vx-card" style="display: none;">
                <h5 class="fw-bold mb-1">Change Password</h5>
                <p class="text-muted small mb-4">Update your password to keep your account secure</p>

                <div class="mb-3">
                    <label class="settings-label">Current Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" class="settings-input" id="currentPassword" placeholder="Enter current password" data-testid="input-current-password">
                        <i class="bi bi-eye password-toggle" onclick="togglePasswordVisibility('currentPassword', this)"></i>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="settings-label">New Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" class="settings-input" id="newPassword" placeholder="Enter new password" data-testid="input-new-password">
                        <i class="bi bi-eye password-toggle" onclick="togglePasswordVisibility('newPassword', this)"></i>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="settings-label">Confirm New Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" class="settings-input" id="confirmPassword" placeholder="Confirm new password" data-testid="input-confirm-password">
                        <i class="bi bi-eye password-toggle" onclick="togglePasswordVisibility('confirmPassword', this)"></i>
                    </div>
                </div>

                <button class="btn btn-primary w-100 py-2 rounded-3 fw-bold" style="background: #5d8df4; border: none;" onclick="updatePassword()" data-testid="button-update-password">
                    <i class="bi bi-key me-2"></i>
                    Update Password
                </button>
            </div>

            <!-- Notification Preferences Section -->
            <div id="notificationPreferencesSection" class="vx-card" style="display: none;">
                <h5 class="fw-bold mb-1">Notification Preferences</h5>
                <p class="text-muted small mb-4">Manage how you receive notifications</p>

                <div class="notification-item">
                    <div>
                        <h6 class="fw-bold mb-0">Email Notifications</h6>
                        <p class="text-muted small mb-0">Receive notifications via email</p>
                    </div>
                    <div class="toggle-switch active" id="toggleEmailNotifications" onclick="toggleNotificationSetting(this)" data-testid="toggle-email-notifications"></div>
                </div>

                <div class="notification-section-title">Notification Types</div>

                <div class="notification-item">
                    <div>
                        <h6 class="fw-bold mb-0">Sales Alerts</h6>
                        <p class="text-muted small mb-0">Get notified when your items are sold</p>
                    </div>
                    <div class="toggle-switch active" id="toggleSalesAlerts" onclick="toggleNotificationSetting(this)" data-testid="toggle-sales-alerts"></div>
                </div>

                <div class="notification-item">
                    <div>
                        <h6 class="fw-bold mb-0">Bid Alerts</h6>
                        <p class="text-muted small mb-0">Receive notifications for new bids</p>
                    </div>
                    <div class="toggle-switch active" id="toggleBidAlerts" onclick="toggleNotificationSetting(this)" data-testid="toggle-bid-alerts"></div>
                </div>

                <div class="notification-item">
                    <div>
                        <h6 class="fw-bold mb-0">Exhibition Updates</h6>
                        <p class="text-muted small mb-0">Updates about exhibitions you're participating in</p>
                    </div>
                    <div class="toggle-switch active" id="toggleExhibitionUpdates" onclick="toggleNotificationSetting(this)" data-testid="toggle-exhibition-updates"></div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Create Exhibition Modal -->
<div class="vx-modal-overlay" id="createExhibitionModalOverlay">
    <div class="vx-modal">
        <form id="createExhibitionForm" onsubmit="event.preventDefault(); createExhibition(this);" enctype="multipart/form-data">
            <div class="vx-modal-header border-0">
                <h5 class="fw-bold mb-0 mx-auto">Create New Exhibition</h5>
                <button type="button" class="vx-modal-close" onclick="closeCreateExhibitionModal()">&times;</button>
            </div>
            <div class="vx-modal-body pt-0">
                <p class="text-muted small text-center mb-4">Create a new exhibition to showcase your NFT collections and artworks.</p>
                
                <h6 class="fw-bold mb-3">Basic Information</h6>
                
                <div class="mb-3">
                    <label class="form-label-custom">Exhibition Title *</label>
                    <input type="text" name="title" class="form-control-custom" placeholder="Enter exhibition title" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Description</label>
                    <textarea name="description" class="form-control-custom" rows="3" placeholder="Describe your exhibition..."></textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Start Date *</label>
                    <input type="date" name="startDate" class="form-control-custom" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">End Date *</label>
                    <input type="date" name="endDate" class="form-control-custom" required>
                </div>
                
                <div class="row g-2 mb-4">
                    <div class="col-6">
                        <label class="form-label-custom">Category *</label>
                        <select name="category" class="form-control-custom" required>
                            <option value="Art">Art</option>
                            <option value="Photography">Photography</option>
                            <option value="Digital">Digital</option>
                            <option value="Collectibles">Collectibles</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="form-label-custom">Status</label>
                        <select name="status" class="form-control-custom">
                            <option value="draft">Draft</option>
                            <option value="active">Published</option>
                        </select>
                    </div>
                </div>
                
                <h6 class="fw-bold mb-3">Images</h6>
                
                <div class="mb-4">
                    <label class="form-label-custom">Thumbnail Image</label>
                    <div class="upload-zone py-4" onclick="document.getElementById('exhibitionThumbnailInput').click()">
                        <i class="bi bi-upload fs-3 text-primary mb-2"></i>
                        <h6 class="fw-bold mb-1" id="exhibitionThumbnailLabel">Add thumbnail</h6>
                        <p class="text-muted small mb-2">Click to upload or drag and drop</p>
                    </div>
                    <input type="file" name="thumbnail" id="exhibitionThumbnailInput" accept="image/*" style="display: none;" onchange="document.getElementById('exhibitionThumbnailLabel').innerText = this.files[0]?.name || 'Add thumbnail'">
                </div>

                <h6 class="fw-bold mb-3">Location</h6>
                <div class="mb-3">
                    <label class="form-label-custom">Location Type</label>
                    <select name="locationType" class="form-control-custom">
                        <option value="virtual">Virtual</option>
                        <option value="physical">Physical</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="form-label-custom">Virtual URL</label>
                    <input type="text" name="virtualUrl" class="form-control-custom" placeholder="https://...">
                </div>
            </div>
            <div class="vx-modal-footer border-0 flex-row-reverse justify-content-start gap-2">
                <button type="submit" class="btn btn-primary py-2 px-4 rounded-3 fw-bold flex-grow-1" style="background: #5d8df4; border: none;">Create Exhibition</button>
                <button type="button" class="btn btn-light py-2 px-4 rounded-3 fw-bold flex-grow-1" onclick="closeCreateExhibitionModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Create Auction Modal -->
<div class="vx-modal-overlay" id="createAuctionModalOverlay">
    <div class="vx-modal">
        <form id="createAuctionForm" onsubmit="event.preventDefault(); createAuction(this);">
            <div class="vx-modal-header border-0">
                <h5 class="fw-bold mb-0 mx-auto">Create New Auction</h5>
                <button type="button" class="vx-modal-close" onclick="closeCreateAuctionModal()">&times;</button>
            </div>
            <div class="vx-modal-body pt-0">
                <div class="mb-3">
                    <label class="form-label-custom">Select NFT</label>
                    <select name="nftId" id="auctionNftSelect" class="form-control-custom" required>
                        <option value="">Choose an NFT to auction</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Auction Type</label>
                    <select name="auctionType" class="form-control-custom" required>
                        <option value="english">English Auction</option>
                        <option value="dutch">Dutch Auction</option>
                        <option value="sealed">Sealed Bid</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Starting Price (WETH)</label>
                    <input type="number" name="startingPrice" step="0.01" class="form-control-custom" placeholder="0.00" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Minimum Bid (WETH)</label>
                    <input type="number" name="minimumBid" step="0.01" class="form-control-custom" placeholder="0.00" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Bid Increment (WETH)</label>
                    <input type="number" name="bidIncrement" step="0.01" class="form-control-custom" placeholder="0.00" required>
                </div>
                
                <div class="row g-2 mb-4">
                    <div class="col-6">
                        <label class="form-label-custom">Start Time</label>
                        <input type="datetime-local" name="startTime" class="form-control-custom" required>
                    </div>
                    <div class="col-6">
                        <label class="form-label-custom">End Time</label>
                        <input type="datetime-local" name="endTime" class="form-control-custom" required>
                    </div>
                </div>
            </div>
            <div class="vx-modal-footer border-0 flex-row-reverse justify-content-start gap-2">
                <button type="submit" class="btn btn-primary py-2 px-4 rounded-3 fw-bold flex-grow-1" style="background: #5d8df4; border: none;">Create Auction</button>
                <button type="button" class="btn btn-light py-2 px-4 rounded-3 fw-bold flex-grow-1" onclick="closeCreateAuctionModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- List NFT Modal -->
<div class="vx-modal-overlay" id="listNFTModalOverlay">
    <div class="vx-modal">
        <form id="listNFTForm" onsubmit="event.preventDefault(); listNFTForSale(this);">
            <div class="vx-modal-header border-0">
                <h5 class="fw-bold mb-0 mx-auto">List NFT for Sale</h5>
                <button type="button" class="vx-modal-close" onclick="closeListNFTModal()">&times;</button>
            </div>
            <div class="vx-modal-body text-center pt-0">
                <p class="text-muted small mb-4">Choose an NFT from your collection and set a price.</p>
                
                <div class="text-start mb-3">
                    <label class="form-label-custom">Select NFT</label>
                    <select name="nftId" id="listNftSelect" class="form-control-custom" required>
                        <option value="">Choose an NFT</option>
                    </select>
                </div>
                
                <div class="text-start mb-4">
                    <label class="form-label-custom">Price</label>
                    <div class="d-flex gap-2">
                        <input type="number" name="price" step="0.01" class="form-control-custom mb-0 flex-grow-1" placeholder="0.00" required>
                        <select name="currency" class="form-control-custom mb-0" style="width: 120px;">
                            <option value="ETH">ETH</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="vx-modal-footer border-0">
                <button type="submit" class="btn btn-primary py-2 rounded-3 fw-bold" style="background: #5d8df4; border: none;">List NFT</button>
                <button type="button" class="btn btn-light py-2 rounded-3 fw-bold" onclick="closeListNFTModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Create Collection Modal -->
<div class="vx-modal-overlay" id="createModalOverlay">
    <div class="vx-modal">
        <form id="createCollectionForm" onsubmit="event.preventDefault(); createCollection(this);" enctype="multipart/form-data">
            <div class="vx-modal-header">
                <h5 class="fw-bold mb-0">Create New Collection</h5>
                <button type="button" class="vx-modal-close" onclick="closeCreateModal()">&times;</button>
            </div>
            <div class="vx-modal-body">
                <div class="mb-4">
                    <label class="form-label-custom">Collection Image *</label>
                    <div class="upload-zone" onclick="document.getElementById('collectionImageInput').click()">
                        <i class="bi bi-upload fs-2 text-muted mb-2"></i>
                        <h6 class="fw-bold mb-1" id="collectionImageLabel">Upload Collection Image</h6>
                        <p class="text-muted small mb-0">PNG, JPG, GIF up to 10MB</p>
                    </div>
                    <input type="file" name="image" id="collectionImageInput" accept="image/*" style="display: none;" onchange="document.getElementById('collectionImageLabel').innerText = this.files[0]?.name || 'Upload Collection Image'">
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Collection Name *</label>
                    <input type="text" name="name" class="form-control-custom" placeholder="My Awesome Collection" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Symbol *</label>
                    <input type="text" name="symbol" class="form-control-custom" placeholder="MAC" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label-custom">Description</label>
                    <textarea name="description" class="form-control-custom" rows="3" placeholder="Describe your collection..."></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="form-label-custom">Category *</label>
                    <select name="category" class="form-control-custom" required>
                        <option value="Art">Art</option>
                        <option value="Collectibles">Collectibles</option>
                        <option value="Gaming">Gaming</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label-custom mb-0">Royalty: <span id="royaltyValue">5</span>%</label>
                    </div>
                    <input type="range" name="royalty" class="royalty-slider" min="0" max="20" value="5" oninput="updateRoyalty(this.value)">
                    <p class="text-muted small mb-0">Earn <span id="royaltyValue2">5</span>% when your NFTs are resold</p>
                </div>
            </div>
            <div class="vx-modal-footer">
                <button type="button" class="btn btn-light py-2 rounded-3 fw-bold" onclick="closeCreateModal()">Cancel</button>
                <button type="submit" class="btn btn-primary py-2 rounded-3 fw-bold" style="background: #5d8df4; border: none;">Create Collection</button>
            </div>
        </form>
    </div>
</div>

<!-- Mint NFT Modal -->
<div class="vx-modal-overlay" id="mintNFTModalOverlay">
    <div class="vx-modal mint-modal">
        <div class="vx-modal-header border-0 pb-0">
            <h4 class="fw-bold mb-0 mx-auto">Create NFT</h4>
            <button type="button" class="vx-modal-close" onclick="closeMintModal()">&times;</button>
        </div>
        <p class="text-muted text-center small px-4 mb-3">Transform your digital creation into a unique, verifiable asset on the blockchain</p>
        
        <!-- Progress Steps -->
        <div class="mint-steps px-4 mb-4">
            <div class="mint-step active" data-step="1">
                <div class="step-circle">1</div>
                <span class="step-label">Upload</span>
            </div>
            <div class="step-line"></div>
            <div class="mint-step" data-step="2">
                <div class="step-circle">2</div>
                <span class="step-label">Details</span>
            </div>
            <div class="step-line"></div>
            <div class="mint-step" data-step="3">
                <div class="step-circle">3</div>
                <span class="step-label">Pricing</span>
            </div>
            <div class="step-line"></div>
            <div class="mint-step" data-step="4">
                <div class="step-circle">4</div>
                <span class="step-label">Review</span>
            </div>
            <div class="step-line"></div>
            <div class="mint-step" data-step="5">
                <div class="step-circle">5</div>
                <span class="step-label">Success</span>
            </div>
        </div>
        
        <div class="vx-modal-body pt-0">
            <!-- Step 1: Upload -->
            <div class="mint-step-content active" id="mintStep1">
                <div class="vx-card mb-4">
                    <h5 class="fw-bold mb-2">Upload Your Asset</h5>
                    <p class="text-muted small mb-3">File types supported: JPG, PNG, GIF, SVG, MP4, WEBM, MP3, WAV. Max size: 50 MB</p>
                    
                    <!-- Media Type Selector -->
                    <div class="media-type-selector mb-4">
                        <label class="form-label-custom mb-2">Select Media Type</label>
                        <div class="d-flex gap-2 flex-wrap">
                            <button type="button" class="media-type-btn active" data-type="image" onclick="selectMediaType('image')">
                                <i class="bi bi-image"></i>
                                <span>Image</span>
                            </button>
                            <button type="button" class="media-type-btn" data-type="gif" onclick="selectMediaType('gif')">
                                <i class="bi bi-filetype-gif"></i>
                                <span>GIF</span>
                            </button>
                            <button type="button" class="media-type-btn" data-type="video" onclick="selectMediaType('video')">
                                <i class="bi bi-play-circle"></i>
                                <span>Video</span>
                            </button>
                            <button type="button" class="media-type-btn" data-type="audio" onclick="selectMediaType('audio')">
                                <i class="bi bi-music-note-beamed"></i>
                                <span>Audio</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Upload Zone -->
                    <div class="mint-upload-zone" id="mintUploadZone" onclick="document.getElementById('mintFileInput').click()" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                        <div class="upload-content" id="uploadContent">
                            <i class="bi bi-upload fs-1 text-muted mb-2"></i>
                            <p class="fw-bold mb-1">Drag and drop your file here</p>
                            <p class="text-muted small mb-3">or</p>
                            <button type="button" class="btn btn-primary rounded-pill px-4" style="background: #5d8df4; border: none;">Browse Files</button>
                        </div>
                        <div class="upload-preview" id="uploadPreview" style="display: none;">
                            <div id="previewContainer"></div>
                            <p class="file-name mt-2 small" id="uploadedFileName"></p>
                            <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="event.stopPropagation(); clearUpload()">Remove</button>
                        </div>
                    </div>
                    <input type="file" id="mintFileInput" style="display: none;" onchange="handleFileSelect(this)">
                </div>
            </div>
            
            <!-- Step 2: Details -->
            <div class="mint-step-content" id="mintStep2">
                <div class="vx-card">
                    <h5 class="fw-bold mb-2">NFT Details</h5>
                    <p class="text-muted small mb-4">Provide information about your NFT</p>
                    
                    <div class="mb-3">
                        <label class="form-label-custom">Name <span class="text-danger">*</span></label>
                        <input type="text" id="mintNftName" class="form-control-custom" placeholder="e.g. Ethereal Dreams #1">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label-custom">Description</label>
                        <textarea id="mintNftDescription" class="form-control-custom" rows="3" placeholder="Describe your NFT in detail..."></textarea>
                        <p class="text-muted small mt-1">The description will be included in the NFT's metadata and displayed on the detail page.</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label-custom">Collection (Optional)</label>
                        <select id="mintNftCollection" class="form-control-custom">
                            <option value="">No Collection</option>
                        </select>
                        <p class="text-muted small mt-1">You can add this NFT to a collection later if you don't choose one now.</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label-custom">Category <span class="text-danger">*</span></label>
                        <select id="mintNftCategory" class="form-control-custom">
                            <option value="Art">Art</option>
                            <option value="Photography">Photography</option>
                            <option value="Music">Music</option>
                            <option value="Video">Video</option>
                            <option value="Collectibles">Collectibles</option>
                            <option value="Gaming">Gaming</option>
                        </select>
                    </div>
                    <div class="mb-4">
  <label class="form-label-custom">
    Tags <span class="text-muted">(select applicable tags)</span>
  </label>

  <div id="mintTagContainer" class="tag-container"></div>
</div>

                    <div class="mb-4">
                        <label class="form-label-custom">Rarity <span class="text-danger">*</span></label>
                        <div class="rarity-options">
                            <label class="rarity-option active" onclick="selectRarity(this)">
                                <input type="radio" name="mintRarity" value="Common" checked style="display:none;">
                                <span class="rarity-dot"></span>
                                <span>Common</span>
                            </label>
                            <label class="rarity-option" onclick="selectRarity(this)">
                                <input type="radio" name="mintRarity" value="Rare" style="display:none;">
                                <span class="rarity-dot"></span>
                                <span>Rare</span>
                            </label>
                            <label class="rarity-option" onclick="selectRarity(this)">
                                <input type="radio" name="mintRarity" value="Epic" style="display:none;">
                                <span class="rarity-dot"></span>
                                <span>Epic</span>
                            </label>
                            <label class="rarity-option" onclick="selectRarity(this)">
                                <input type="radio" name="mintRarity" value="Legendary" style="display:none;">
                                <span class="rarity-dot"></span>
                                <span>Legendary</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label-custom mb-0">Attributes (Optional)</label>
                            <button type="button" class="btn btn-sm btn-outline-primary rounded-pill" onclick="addAttribute()">
                                <i class="bi bi-plus"></i> Add Attribute
                            </button>
                        </div>
                        <div id="attributesContainer"></div>
                    </div>
                </div>
            </div>
            <style>
.tag-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.mint-tag {
  padding: 8px 14px;
  border-radius: 20px;
  background: #1c1c24;
  color: #b5b5b5;
  font-size: 13px;
  cursor: pointer;
  border: 1px solid #2a2a35;
  transition: all 0.2s ease;
}

.mint-tag:hover {
  border-color: #6f5eff;
  color: #ffffff;
}

.mint-tag.active {
  background: #6f5eff;
  color: #ffffff;
  border-color: #6f5eff;
}
</style>

            <script>
const CATEGORY_TAGS = {
  Art: [
    'Digital Art',
    'Abstract',
    'Illustration',
    '3D Art',
    'Pixel Art',
    'AI Art',
    'Concept Art'
  ],
  Photography: [
    'Portrait',
    'Landscape',
    'Street',
    'Nature',
    'Black & White',
    'Macro',
    'Urban'
  ],
  Music: [
    'Hip Hop',
    'Afrobeats',
    'Electronic',
    'Instrumental',
    'Soundtrack',
    'Vocal',
    'Experimental'
  ],
  Video: [
    'Animation',
    'Short Film',
    'Motion Graphics',
    'Cinematic',
    'Loop',
    'Visual FX',
    'Storytelling'
  ],
  Collectibles: [
    'PFP',
    'Limited Edition',
    'Series',
    'Avatar',
    'Handcrafted',
    'Signed',
    'Exclusive'
  ],
  Gaming: [
    'Weapon',
    'Character',
    'Skin',
    'Metaverse',
    'Power-Up',
    'Land',
    'Item'
  ]
};

const tagContainer = document.getElementById('mintTagContainer');
const categorySelect = document.getElementById('mintNftCategory');

function renderTags(category) {
  tagContainer.innerHTML = '';

  CATEGORY_TAGS[category].forEach(tag => {
    const tagEl = document.createElement('span');
    tagEl.className = 'mint-tag';
    tagEl.textContent = tag;

    tagEl.onclick = () => {
      tagEl.classList.toggle('active');
    };

    tagContainer.appendChild(tagEl);
  });
}

// Initial load
renderTags(categorySelect.value);

// On category change
categorySelect.addEventListener('change', (e) => {
  renderTags(e.target.value);
});
</script>

            <!-- Step 3: Pricing -->
            <div class="mint-step-content" id="mintStep3">
                <div class="vx-card">
                    <h5 class="fw-bold mb-2">Pricing & Royalties</h5>
                    <p class="text-muted small mb-4">Set your pricing and royalty preferences</p>
                    
                    <div class="mb-4">
                        <label class="list-immediately-option">
                            <input type="checkbox" id="listImmediately" onchange="togglePricingOptions()">
                            <span class="checkmark"></span>
                            <span>List this NFT for sale immediately after minting</span>
                        </label>
                    </div>
                    
                    <div id="pricingOptions" style="display: none;">
                        <div class="mb-4">
                            <label class="form-label-custom">Sale Type</label>
                            <div class="sale-type-options">
                                <label class="sale-type-option active">
                                    <input type="radio" name="saleType" value="fixed" checked onchange="toggleSaleType()">
                                    <div class="sale-type-content">
                                        <span class="sale-type-dot"></span>
                                        <div>
                                            <strong>Fixed Price</strong>
                                            <p class="text-muted small mb-0">List your NFT at a fixed price</p>
                                        </div>
                                    </div>
                                </label>
                                <label class="sale-type-option">
                                    <input type="radio" name="saleType" value="auction" onchange="toggleSaleType()">
                                    <div class="sale-type-content">
                                        <span class="sale-type-dot"></span>
                                        <div>
                                            <strong>Timed Auction</strong>
                                            <p class="text-muted small mb-0">Auction your NFT to the highest bidder</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label-custom">Price <span class="text-danger">*</span></label>
                            <input type="number" id="mintPrice" class="form-control-custom" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label-custom">Currency</label>
                            <select id="mintCurrency" class="form-control-custom">
                                <option value="ETH">ETH</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label-custom mb-0">Creator Royalty</label>
                            <span class="fw-bold" id="mintRoyaltyValue">5%</span>
                        </div>
                        <input type="range" id="mintRoyaltySlider" class="royalty-slider" min="0" max="20" value="5" oninput="updateMintRoyalty(this.value)">
                        <div class="d-flex align-items-start gap-2 mt-2 p-3 bg-light rounded-3">
                            <i class="bi bi-info-circle text-muted"></i>
                            <p class="text-muted small mb-0">You'll receive <span id="mintRoyaltyPercent">5</span>% of the sale price every time this NFT is resold on secondary markets.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Review -->
            <div class="mint-step-content" id="mintStep4">
                <div class="vx-card mb-4">
                    <h5 class="fw-bold mb-2">Review & Mint</h5>
                    <p class="text-muted small mb-4">Review your NFT details before minting</p>
                    
                    <div class="review-preview mb-4">
                        <div class="preview-media" id="reviewPreviewMedia">
                            <i class="bi bi-file-earmark-image"></i>
                        </div>
                        <h6 class="fw-bold mt-3" id="reviewNftName">NFT Name</h6>
                        <p class="text-muted small" id="reviewNftCategory">Category</p>
                    </div>
                    
                    <div class="review-details mb-4">
                        <h6 class="fw-bold mb-3">NFT Details</h6>
                        <div class="review-row">
                            <span>Name</span>
                            <span id="reviewDetailName">-</span>
                        </div>
                        <div class="review-row">
                            <span>File</span>
                            <span id="reviewDetailFile">-</span>
                        </div>
                        <div class="review-row">
                            <span>Attributes</span>
                            <span id="reviewDetailAttributes">0</span>
                        </div>
                    </div>
                    
                    <div class="review-details mb-4">
                        <h6 class="fw-bold mb-3">Pricing</h6>
                        <div class="review-row">
                            <span>List Immediately</span>
                            <span id="reviewListImmediate" class="badge bg-success">Yes</span>
                        </div>
                        <div class="review-row">
                            <span>Sale Type</span>
                            <span id="reviewSaleType">Fixed Price</span>
                        </div>
                        <div class="review-row">
                            <span>Price</span>
                            <span id="reviewPrice">-</span>
                        </div>
                        <div class="review-row">
                            <span>Creator Royalty</span>
                            <span id="reviewRoyalty">5%</span>
                        </div>
                    </div>
                    
                    <div class="review-details mb-4">
                        <h6 class="fw-bold mb-3">Fees & Gas</h6>
                        <div class="review-row">
                            <span>Minting Fee</span>
                            <span>0.200 ETH</span>
                        </div>
                        <div class="review-row">
                            <span>Network</span>
                            <span>Ethereum</span>
                        </div>
                    </div>
                    
                    <label class="terms-checkbox">
                        <input type="checkbox" id="agreeTerms">
                        <span class="checkmark"></span>
                        <span>I agree to the Terms of Service and confirm that I own the rights to this content.</span>
                    </label>
                    <p class="text-danger small mt-2" id="termsError" style="display: none;">You must accept the terms and conditions to mint</p>
                </div>
            </div>
            
            <!-- Step 5: Success -->
            <div class="mint-step-content" id="mintStep5">
                <div class="vx-card text-center py-5">
                    <div class="success-icon mb-4">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                    </div>
                    <h4 class="fw-bold mb-2">NFT Minted Successfully!</h4>
                    <p class="text-muted mb-4">Your NFT has been created and added to the blockchain.</p>
                    <div id="successPreview" class="mb-4"></div>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <button class="btn btn-primary rounded-pill px-4" style="background: #5d8df4; border: none;" onclick="viewMintedNFT()">View NFT</button>
                        <button class="btn btn-outline-primary rounded-pill px-4" onclick="mintAnother()">Mint Another</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Navigation -->
        <div class="vx-modal-footer border-0 justify-content-between" id="mintFooter">
            <button type="button" class="btn btn-light rounded-pill px-4" id="mintBackBtn" onclick="prevMintStep()" style="display: none;">
                <i class="bi bi-arrow-left me-1"></i> Back
            </button>
            <div class="flex-grow-1"></div>
            <button type="button" class="btn btn-primary rounded-pill px-4" id="mintNextBtn" onclick="nextMintStep()" style="background: #5d8df4; border: none;">
                Next <i class="bi bi-arrow-right ms-1"></i>
            </button>
            <button type="button" class="btn btn-primary rounded-pill px-4" id="mintSubmitBtn" onclick="submitMint()" style="background: #5d8df4; border: none; display: none;">
                Mint NFT
            </button>
        </div>
    </div>
</div>

<!-- Deposit Modal -->
<div class="vx-modal-overlay" id="depositModalOverlay">
    <div class="vx-modal" style="max-width: 500px;">
        <div class="vx-modal-header border-0">
            <button class="btn btn-link text-decoration-none p-0" onclick="closeDepositModal()">
                <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
            </button>
            <button type="button" class="vx-modal-close" onclick="closeDepositModal()">&times;</button>
        </div>
        <div class="vx-modal-body" id="depositModalBody">
            <div class="vx-card mb-4">
                <h4 class="fw-bold mb-2">Deposit ETH</h4>
                <p class="text-muted mb-0">Send ETH to the platform wallet and request approval</p>
            </div>
            
            <div class="vx-card mb-4">
                <h6 class="fw-bold mb-3">Platform Wallet Address</h6>
                <div class="text-center mb-3">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <i class="bi bi-qr-code"></i>
                        <span class="fw-semibold">Scan QR Code</span>
                    </div>
                    <p class="text-muted small mb-3">Use your wallet app to scan this code</p>
                    <div id="depositQRCode" class="d-flex justify-content-center mb-3"></div>
                </div>
                
                <div class="deposit-address-box d-flex align-items-center justify-content-between gap-2 p-3 bg-light rounded-3 mb-3">
                    <code class="text-break" id="platformWalletAddress" style="font-size: 0.85rem;">0xe22a4544493ea404ba336e9e3</code>
                    <button class="btn btn-link p-0" onclick="copyWalletAddress()" title="Copy address">
                        <i class="bi bi-copy"></i>
                    </button>
                </div>
                
                <div class="alert alert-light border-0 mb-0" style="background: #fff8f0;">
                    <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                    <span class="small">Send ETH only to this address. Sending other tokens may result in permanent loss.</span>
                </div>
            </div>
            
            <div class="vx-card mb-4">
                <div class="d-flex align-items-start gap-2 mb-3">
                    <i class="bi bi-info-circle text-muted"></i>
                    <div>
                        <h6 class="fw-bold mb-2">Deposit Instructions:</h6>
                        <ol class="mb-0 ps-3 text-muted small">
                            <li class="mb-1">Send ETH to the platform wallet address above</li>
                            <li class="mb-1">Wait for transaction confirmation</li>
                            <li class="mb-1">Fill out the form below with transaction details</li>
                            <li class="mb-1">Wait for admin approval (usually within 24 hours)</li>
                            <li class="mb-0">Your wallet balance will be updated after approval</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <form id="depositForm" onsubmit="submitDeposit(event)">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Amount <span class="text-danger">*</span></label>
                    <div class="d-flex gap-2">
                        <input type="number" class="form-control flex-grow-1" id="depositAmount" placeholder="0.00" step="0.0001" required>
                        <select class="form-select" id="depositCurrency" style="max-width: 100px;">
                            <option value="ETH">ETH</option>
                            <option value="WETH">WETH</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label fw-semibold">Transaction Hash <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="depositTxHash" placeholder="0x..." required>
                    <small class="text-muted">Enter the transaction hash from your wallet after sending ETH</small>
                </div>
                
                <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold" style="background: #5d8df4; border: none;">
                    Submit Deposit Request
                </button>
                <button type="button" class="btn btn-outline-secondary w-100 py-2 rounded-3 mt-2" onclick="closeDepositModal(); openDepositHistoryModal();">
                    <i class="bi bi-clock-history me-2"></i>View Deposit History
                </button>
            </form>
            
            <div class="alert alert-danger border-0 mt-4 mb-0" style="background: #fff5f5;">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                    <div>
                        <strong class="text-danger">Warning:</strong>
                        <p class="mb-0 text-danger small">Only send ETH from networks we support. Double-check the wallet address before sending.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Withdraw Modal -->
<div class="vx-modal-overlay" id="withdrawModalOverlay">
    <div class="vx-modal" style="max-width: 500px;">
        <div class="vx-modal-header border-0">
            <button class="btn btn-link text-decoration-none p-0" onclick="closeWithdrawModal()">
                <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
            </button>
            <button type="button" class="vx-modal-close" onclick="closeWithdrawModal()">&times;</button>
        </div>
        <div class="vx-modal-body" id="withdrawModalBody">
            <div class="vx-card mb-4">
                <h4 class="fw-bold mb-2">Withdraw Funds</h4>
                <p class="text-muted mb-0">Request a withdrawal to your external wallet</p>
            </div>
            
            <div class="vx-card mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Available Balance</span>
                    <span class="fw-bold" id="withdrawAvailableBalance">0.00 ETH</span>
                </div>
            </div>
            
            <form id="withdrawForm" onsubmit="submitWithdraw(event)">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Wallet Address <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="withdrawWallet" placeholder="0x..." required>
                    <small class="text-muted">Enter your external wallet address</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-semibold">Amount <span class="text-danger">*</span></label>
                    <div class="d-flex gap-2">
                        <input type="number" class="form-control flex-grow-1" id="withdrawAmount" placeholder="0.00" step="0.0001" required>
                        <select class="form-select" id="withdrawCurrency" style="max-width: 100px;">
                            <option value="ETH">ETH</option>
                            <!-- <option value="WETH">WETH</option> -->
                        </select>
                    </div>
                    <div class="d-flex justify-content-end mt-1">
                        <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="setMaxWithdraw()">Max</button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label fw-semibold">Network <span class="text-danger">*</span></label>
                    <select class="form-select" id="withdrawNetwork" required>
                        <option value="">Select Network</option>
                        <option value="ethereum">Ethereum Mainnet</option>
                        <!-- <option value="polygon">Polygon</option>
                        <option value="arbitrum">Arbitrum</option>
                        <option value="optimism">Optimism</option>
                        <option value="base">Base</option>
                        <option value="bsc">BNB Smart Chain</option> -->
                    </select>
                </div>
                
                <div class="vx-card mb-4" style="background: #f8f9fa;">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Withdrawal Amount</span>
                        <span class="small" id="withdrawSummaryAmount">0.00 ETH</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Network Fee (est.)</span>
                        <span class="small">~0.001 ETH</span>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold">You'll Receive</span>
                        <span class="fw-bold" id="withdrawReceiveAmount">0.00 ETH</span>
                    </div>
                </div>
                
                <button type="submit" class="btn w-100 py-2 rounded-3 fw-bold" style="background: #fd7e14; border: none; color: white;">
                    Submit Withdrawal Request
                </button>
                <button type="button" class="btn btn-outline-secondary w-100 py-2 rounded-3 mt-2" onclick="closeWithdrawModal(); openWithdrawHistoryModal();">
                    <i class="bi bi-clock-history me-2"></i>View Withdrawal History
                </button>
            </form>
            
            <div class="alert alert-warning border-0 mt-4 mb-0" style="background: #fff8f0;">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi bi-info-circle text-warning"></i>
                    <div>
                        <strong>Processing Time:</strong>
                        <p class="mb-0 small">Withdrawal requests are typically processed within 24-48 hours. You will receive an email confirmation once completed.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Convert WETH to ETH Modal -->
<div class="vx-modal-overlay" id="convertModalOverlay">
    <div class="vx-modal" style="max-width: 500px;">
        <div class="vx-modal-header border-0">
            <button class="btn btn-link text-decoration-none p-0" onclick="closeConvertModal()">
                <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
            </button>
            <button type="button" class="vx-modal-close" onclick="closeConvertModal()">&times;</button>
        </div>
        <div class="vx-modal-body" id="convertModalBody">
            <div class="vx-card mb-4">
                <h4 class="fw-bold mb-2">Convert WETH to ETH</h4>
                <p class="text-muted mb-0">Convert your WETH balance to ETH for withdrawals</p>
            </div>
            
            <div class="alert alert-warning border-0 mb-4">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi bi-exclamation-triangle"></i>
                    <div>
                        <strong>15% Conversion Fee</strong>
                        <p class="mb-0 small">A 15% fee will be deducted from your ETH balance when converting.</p>
                    </div>
                </div>
            </div>
            
            <div class="vx-card mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Available WETH Balance</span>
                    <span class="fw-bold" id="convertAvailableWeth">0.0000 WETH</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Current ETH Balance</span>
                    <span class="fw-bold" id="convertCurrentEth">0.0000 ETH</span>
                </div>
            </div>
            
            <form id="convertForm" onsubmit="submitConvert(event)">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Amount to Convert <span class="text-danger">*</span></label>
                    <div class="d-flex gap-2">
                        <input type="number" class="form-control flex-grow-1" id="convertAmount" placeholder="0.00" step="0.0001" required>
                        <span class="input-group-text">WETH</span>
                    </div>
                    <div class="d-flex justify-content-end mt-1">
                        <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="setMaxConvert()">Max</button>
                    </div>
                </div>
                
                <div class="vx-card mb-4" style="background: #f8f9fa;">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Convert Amount</span>
                        <span class="small" id="convertSummaryAmount">0.00 WETH</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Fee (15% from ETH)</span>
                        <span class="small text-danger" id="convertFeeAmount">-0.00 ETH</span>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold">You'll Receive</span>
                        <span class="fw-bold text-success" id="convertReceiveAmount">0.00 ETH</span>
                    </div>
                </div>
                
                <button type="submit" class="btn w-100 py-2 rounded-3 fw-bold" style="background: #6f42c1; border: none; color: white;">
                    <i class="bi bi-arrow-left-right me-2"></i>Convert Now
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Deposit History Modal -->
<div class="vx-modal-overlay" id="depositHistoryModalOverlay">
    <div class="vx-modal" style="max-width: 600px;">
        <div class="vx-modal-header border-0">
            <button class="btn btn-link text-decoration-none p-0" onclick="closeDepositHistoryModal()">
                <i class="bi bi-arrow-left me-2"></i> Back
            </button>
            <button type="button" class="vx-modal-close" onclick="closeDepositHistoryModal()">&times;</button>
        </div>
        <div class="vx-modal-body">
            <h4 class="fw-bold mb-4">Deposit History</h4>
            <div id="depositHistoryList" class="text-center py-4">
                <i class="bi bi-hourglass-split"></i> Loading...
            </div>
        </div>
    </div>
</div>

<!-- Withdrawal History Modal -->
<div class="vx-modal-overlay" id="withdrawHistoryModalOverlay">
    <div class="vx-modal" style="max-width: 600px;">
        <div class="vx-modal-header border-0">
            <button class="btn btn-link text-decoration-none p-0" onclick="closeWithdrawHistoryModal()">
                <i class="bi bi-arrow-left me-2"></i> Back
            </button>
            <button type="button" class="vx-modal-close" onclick="closeWithdrawHistoryModal()">&times;</button>
        </div>
        <div class="vx-modal-body">
            <h4 class="fw-bold mb-4">Withdrawal History</h4>
            <div id="withdrawHistoryList" class="text-center py-4">
                <i class="bi bi-hourglass-split"></i> Loading...
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const pageTitle = document.getElementById('pageTitle');
    
    let collections = [];
    let nfts = [];
    let sales = [];
    let auctions = [];
    let exhibitions = [];
    let transactions = [];

    function toggleSidebar() {
        sidebar.classList.toggle('show');
        sidebarOverlay.classList.toggle('show');
    }

    if (sidebarToggle) sidebarToggle.addEventListener('click', toggleSidebar);
    if (sidebarOverlay) sidebarOverlay.addEventListener('click', toggleSidebar);

    function toggleViewOptions() {
        const panel = document.getElementById('viewOptionsPanel');
        const isVisible = panel.style.display === 'flex';
        panel.style.display = isVisible ? 'none' : 'flex';
    }

    function openCreateModal() {
        document.getElementById('createModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeCreateModal() {
        document.getElementById('createModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }

    function updateRoyalty(val) {
        document.getElementById('royaltyValue').innerText = val;
        document.getElementById('royaltyValue2').innerText = val;
    }

    function openListNFTModal() {
        loadNFTsForSelect();
        document.getElementById('listNFTModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function openQuickListModal(nftId, nftName) {
        loadNFTsForSelect().then(() => {
            const select = document.getElementById('listNftSelect');
            if (select) {
                select.value = nftId;
            }
        });
        document.getElementById('listNFTModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeListNFTModal() {
        document.getElementById('listNFTModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }

    function openCreateAuctionModal() {
        loadNFTsForAuction();
        document.getElementById('createAuctionModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeCreateAuctionModal() {
        document.getElementById('createAuctionModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }

    function openCreateExhibitionModal() {
        document.getElementById('createExhibitionModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeCreateExhibitionModal() {
        document.getElementById('createExhibitionModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }

    function showPage(page) {
        document.getElementById('dashboardPage').style.display = page === 'dashboard' ? 'block' : 'none';
        document.getElementById('collectionPage').style.display = page === 'collection' ? 'block' : 'none';
        document.getElementById('nftsPage').style.display = page === 'nfts' ? 'block' : 'none';
        document.getElementById('transactionsPage').style.display = page === 'transactions' ? 'block' : 'none';
        document.getElementById('salesPage').style.display = page === 'sales' ? 'block' : 'none';
        document.getElementById('auctionsPage').style.display = page === 'auctions' ? 'block' : 'none';
        document.getElementById('exhibitionsPage').style.display = page === 'exhibitions' ? 'block' : 'none';
        document.getElementById('settingsPage').style.display = page === 'settings' ? 'block' : 'none';
        
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.classList.remove('active');
            if (link.innerText.trim().toLowerCase().includes(page)) {
                link.classList.add('active');
            }
        });

        pageTitle.innerText = page.charAt(0).toUpperCase() + page.slice(1);

        if (window.innerWidth < 992 && sidebar.classList.contains('show')) {
            toggleSidebar();
        }

        if (page === 'dashboard') loadDashboardStats();
        if (page === 'collection') loadCollections();
        if (page === 'nfts') loadNfts();
        if (page === 'transactions') loadTransactions();
        if (page === 'sales') loadSales();
        if (page === 'auctions') loadAuctions();
        if (page === 'exhibitions') loadExhibitions();
        if (page === 'settings') loadSettings();
    }

    async function loadDashboardStats() {
      try {
    const res = await fetch('/api/stats', {
        credentials: 'include', //  IMPORTANT
    });

    if (!res.ok) throw new Error('Failed to fetch stats');

    const data = await res.json();

    document.getElementById('statTotalNfts').innerText = data.totalNfts || 0;
    document.getElementById('statListedNfts').innerText = data.listedNfts || 0;

    if (document.getElementById('statTotalSales')) {
        document.getElementById('statTotalSales').innerText = data.totalSales || 0;
    }

    if (document.getElementById('statActiveAuctions')) {
        document.getElementById('statActiveAuctions').innerText = data.activeAuctions || 0;
    }

    // Load user balances (ETH and WETH)
    await loadUserBalances();

    // Load transactions for dashboard if not already loaded
    if (transactions.length === 0) {
        const txRes = await fetch('/api/transactions', {
            credentials: 'include', //  REQUIRED
        });

        if (!txRes.ok) throw new Error('Failed to fetch transactions');

        const txData = await txRes.json();
        transactions = txData.transactions || [];
    }

    renderDashboardTransactions();

    // Load NFTs for dashboard display
    await loadDashboardNfts();

} catch (err) {
    console.error('Failed to load stats:', err);
}

    }

    let dashboardNftFilter = 'listed';
    let allNfts = [];
    let listedNfts = [];
    let unlistedNfts = [];
    
//    async function loadDashboardNfts() {
//     try {
//         const res = await fetch('/api/nfts/user', {
//             credentials: 'include', //  REQUIRED
//         });

//         const data = await res.json();

//         // All NFTs belonging to this user
//         const allNfts = data.all || [];

//         // NFTs grouped by status
//         const ownedNfts = data.owned || [];
//         const listedNfts = data.listed || [];
//         const soldNfts = data.sold || [];

//         // Unlisted NFTs = owned NFTs that are not listed
//         const unlistedNfts = ownedNfts.filter(
//             n => !listedNfts.find(l => l._id === n._id)
//         );

//         // Update global or component state
//         window.allNfts = allNfts;
//         window.ownedNfts = ownedNfts;
//         window.listedNfts = listedNfts;
//         window.soldNfts = soldNfts;
//         window.unlistedNfts = unlistedNfts;

//         // Update counts in the DOM
//         document.getElementById('listedCount').innerText = listedNfts.length;
//         document.getElementById('unlistedCount').innerText = unlistedNfts.length;
//         document.getElementById('soldCount').innerText = soldNfts.length;
//         document.getElementById('totalCount').innerText = allNfts.length;

//         // Render NFTs to the dashboard
//         renderDashboardNfts();
//     } catch (err) {
//         console.error('Failed to load dashboard NFTs:', err);
//     }
// }


async function loadDashboardNfts() { 
    try { const res = await fetch('/api/nfts/user',
     { credentials: 'include', });
      const data = await res.json();
       allNfts = data.owned || []; 
       listedNfts = data.listed || [];
        unlistedNfts = allNfts.filter(n => !listedNfts.find(l => l._id === n._id)); 
 document.getElementById('listedCount').innerText = listedNfts.length; document.getElementById('unlistedCount').innerText = unlistedNfts.length; renderDashboardNfts(); } catch (err) { console.error('Failed to load dashboard NFTs:', err); } }
    
    function filterDashboardNfts(type, btn) {
        dashboardNftFilter = type;
        document.querySelectorAll('#dashboardNftTabs button').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');
        renderDashboardNfts();
    }
    
    function renderDashboardNfts() {
        const container = document.getElementById('dashboardNftsGrid');
        if (!container) return;
        
        const nftsToShow = dashboardNftFilter === 'listed' ? listedNfts : unlistedNfts;
        const displayNfts = nftsToShow.slice(0, 4); // Show max 4 on dashboard
        
        if (displayNfts.length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="vx-card text-center py-5">
                        <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-search text-muted"></i>
                        </div>
                        <h5 class="fw-bold">${dashboardNftFilter === 'listed' ? 'No listed NFTs' : "No unlisted NFTs"}</h5>
                        <p class="text-muted mb-4">${dashboardNftFilter === 'listed' ? 'List your NFTs for sale' : 'Mint new NFTs to get started'}</p>
                        <button class="btn btn-primary px-4 py-2 rounded-pill shadow-sm" onclick="openMintModal()">Mint NFT</button>
                    </div>
                </div>`;
            return;
        }
        
        container.innerHTML = displayNfts.map(nft => `
            <div class="col-6 col-md-3">
                <div class="vx-card h-100 position-relative">
                    ${nft.imageUrl ? `<img src="${nft.imageUrl}" class="w-100 rounded-3 mb-3" style="height: 150px; object-fit: cover;">` : '<div class="w-100 rounded-3 mb-3 bg-light d-flex align-items-center justify-content-center" style="height: 150px;"><i class="bi bi-gem text-muted fs-1"></i></div>'}
                    <h6 class="fw-bold mb-1 text-truncate">${nft.name}</h6>
                    <p class="text-muted small mb-2">${nft.collection?.name || 'No Collection'}</p>
                    ${nft.status === 'listed' ? `<span class="badge bg-success">${nft.price} ${nft.currency || 'ETH'}</span>` : `<button class="btn btn-sm btn-outline-primary w-100" onclick="openQuickListModal('${nft._id}', '${nft.name.replace(/'/g, "\\'")}')">List for Sale</button>`}
                </div>
            </div>
        `).join('');
    }
    
    let nftsPageFilter = 'listed';
    
   async function loadNfts() {
  try {
    const res = await fetch('/api/nfts/user', {
      method: 'GET',
      credentials: 'include', //  IMPORTANT: send session cookie
    });

    if (!res.ok) {
      throw new Error('Failed to fetch stats');
    }

    const data = await res.json();
console.log(data);

    // If you're using stats instead of /api/nfts
    unlistedNfts = data.owned || [];
console.log(unlistedNfts);

    // Update stats
    document.getElementById('nftsPageTotal').innerText = data.counts.owned+data.counts.listed || 0;
    document.getElementById('nftsPageListed').innerText = data.counts.listed || 0;
    document.getElementById('nftsPageAuctions').innerText = data.counts.auction || 0;
    // document.getElementById('nftsPageValue').innerText =
    //   (data.listedVolume || 0) + ' ETH';

    renderNftsPage();
  } catch (err) {
    console.error('Failed to load NFTs:', err);
  }
}
 
    function filterNftsPage(type, btn) {
        nftsPageFilter = type;
        document.querySelectorAll('#nftPageTabs button').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');
        renderNftsPage();
    }
    async function cancelSale(id) {
        try {
            await fetch(`/api/sales/${id}/cancel`, { method: 'PUT' });
            loadSales();
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to cancel sale', confirmButtonColor: '#5d8df4' });
        }
    }
    function renderNftsPage() {
        const container = document.getElementById('nftsPageGrid');
        if (!container) return;
        
        let nftsToShow = listedNfts;
        if (nftsPageFilter === 'owned') {
            nftsToShow = unlistedNfts;
            console.log(nftsToShow);
            
        }
        
        if (nftsToShow.length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="vx-card text-center py-5">
                        <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-gem text-muted"></i>
                        </div>
                        <h5 class="fw-bold">${nftsPageFilter === 'listed' ? 'No listed NFTs' : 'No unlisted NFTs'}</h5>
                        <p class="text-muted mb-4">${nftsPageFilter === 'listed' ? 'List your NFTs for sale' : 'Mint new NFTs to get started'}</p>
                        <button class="btn btn-primary px-4 py-2 rounded-pill shadow-sm" onclick="openMintModal()">Mint NFT</button>
                    </div>
                </div>`;
            return;
        }
        
        container.innerHTML = nftsToShow.map(nft => `
            <div class="col-6 col-md-4 col-lg-3">
                <div class="vx-card h-100 position-relative">
                    ${nft.imageUrl ? `<img src="${nft.imageUrl}" class="w-100 rounded-3 mb-3" style="height: 180px; object-fit: cover;">` : '<div class="w-100 rounded-3 mb-3 bg-light d-flex align-items-center justify-content-center" style="height: 180px;"><i class="bi bi-gem text-muted fs-1"></i></div>'}
                    <h6 class="fw-bold mb-1">${nft.name}</h6>
                    <p class="text-muted small mb-2">${nft.collection?.name || 'No Collection'}</p>
                    <div class="d-flex justify-content-between align-items-center gap-2">
                        ${nft.status === 'listed' ? `<span class="badge bg-success">${nft.price} ${nft.currency || 'ETH'}</span>
                        <div class="d-flex gap-1">
                           <button class="btn btn-sm btn-outline-danger" onclick="cancelSale('${nft._id}')">Cancel</button>
                        </div>` : `<button class="btn btn-sm btn-outline-primary" onclick="openQuickListModal('${nft._id}', '${nft.name.replace(/'/g, "\\'")}')">List for Sale</button>`}
                        
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    function viewNftDetails(id) {
        Swal.fire({ icon: 'info', title: 'Info', text: 'NFT details view coming soon!', confirmButtonColor: '#5d8df4' });
    }

    async function loadCollections() {
        try {
            const res = await fetch('/api/collections',{
credentials:"include",
            });
            collections = await res.json();
            renderCollections();
        } catch (err) {
            console.error('Failed to load collections:', err);
        }
    }

    function renderCollections() {
        const container = document.getElementById('collectionsGrid');
        const countEl = document.getElementById('totalCollections');
        if (countEl) countEl.innerText = collections.length;
       const nftcount = document.getElementById('totalNftsInside');
const totalCollectionVolume = document.getElementById('totalCollectionVolume');
let nftcounter = 0;
let volumecounter=0

collections.forEach(collection => {
  nftcounter += collection.nftCount || 0;
});

if (nftcount) {
  nftcount.innerText = nftcounter;
}

collections.forEach(collection => {
  volumecounter += collection.totalVolume || 0;
});

if (totalCollectionVolume) {
  totalCollectionVolume.innerText = volumecounter +" "+"WETH";
}


        if (!container) return;
        
        if (collections.length === 0) {
            container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="bi bi-folder-x text-muted display-4 mb-3 d-block"></i>
                    <h5 class="fw-bold mb-2">No collections yet</h5>
                    <p class="text-muted mb-3">Create your first collection to start adding NFTs</p>
                    <button class="btn btn-primary rounded-3 px-4" onclick="openCreateModal()" style="background: #5d8df4; border: none;">
                        <i class="bi bi-plus-lg me-2"></i>Create Collection
                    </button>
                </div>`;
            return;
        }
        
        container.innerHTML = collections.map(c => `
            <div class="col-6 col-md-4 col-lg-3">
                <div class="vx-card h-100 position-relative">
                    ${c.imageUrl ? `<img src="${c.imageUrl}" class="w-100 rounded-3 mb-3" style="height: 150px; object-fit: cover;">` : '<div class="w-100 rounded-3 mb-3 bg-light d-flex align-items-center justify-content-center" style="height: 150px;"><i class="bi bi-image text-muted fs-1"></i></div>'}
                    <h6 class="fw-bold mb-1">${c.name}</h6>
                    <p class="text-muted small mb-2">${c.symbol}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-light text-dark">${c.nftCount || 0} NFTs</span>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCollection('${c._id}')"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    async function deleteCollection(id) {
        const result = await Swal.fire({
            icon: 'warning',
            title: 'Warning',
            text: 'Are you sure you want to delete this collection?',
            showCancelButton: true,
            confirmButtonColor: '#5d8df4',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, delete it'
        });
        if (!result.isConfirmed) return;
        try {
            await fetch(`/api/collections/${id}`, { method: 'DELETE' });
            loadCollections();
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to delete collection', confirmButtonColor: '#5d8df4' });
        }
    }

    async function loadNFTsForSelect() {
        try {
            const res = await fetch('/api/nfts');
            const data = await res.json();
            nfts = data.owned || [];
            // Only show unlisted NFTs in the list dropdown
            const unlistedForSelect = nfts.filter(n => n.status !== 'listed');
            const select = document.getElementById('listNftSelect');
            if (select) {
                select.innerHTML = '<option value="">Choose an NFT</option>' + 
                    unlistedForSelect.map(n => `<option value="${n._id}">${n.name}</option>`).join('');
            }
            return data;
        } catch (err) {
            console.error('Failed to load NFTs:', err);
            return null;
        }
    }

    async function loadNFTsForAuction() {
        try {
            const res = await fetch('/api/nfts');
            const data = await res.json();
            nfts = data.owned || [];
            const select = document.getElementById('auctionNftSelect');
            if (select) {
                select.innerHTML = '<option value="">Choose an NFT to auction</option>' + 
                    nfts.map(n => `<option value="${n._id}">${n.name}</option>`).join('');
            }
        } catch (err) {
            console.error('Failed to load NFTs:', err);
        }
    }

    async function loadSales() {
        try {
            const res = await fetch('/api/nfts/user',{
credentials:"include",
            });
           
           const data = await res.json();
       allNfts = data.owned || []; 
       listedNfts = data.listed || [];
        unlistedNfts = allNfts.filter(n => !listedNfts.find(l => l._id === n._id)); 
            renderSales(data);
        } catch (err) {
            console.error('Failed to load sales:', err);
        }
    }

    function renderSales(data) {
        const container = document.getElementById('salesList');
        const countEl = document.getElementById('salesCount');
        if (countEl) countEl.innerText = data.listed.length + ' listings found';
        
        if (!container) return;
        console.log(data);
        
        if (data.length === 0) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <i class="bi bi-image text-muted display-4 mb-3 d-block"></i>
                    <h5 class="fw-bold mb-2">No listings yet</h5>
                    <p class="text-muted mb-0">You haven't listed any NFTs yet.</p>
                </div>`;
            return;
        }
        
        container.innerHTML = `
           <div class="table-responsive">
  <table class="table table-borderless align-middle mb-0">
    <thead class="text-muted small border-bottom">
      <tr>
        <th class="pb-3 fw-medium">NFT</th>
        <th class="pb-3 fw-medium">Price</th>
        <th class="pb-3 fw-medium">Status</th>
        <th class="pb-3 fw-medium">Listed Date</th>
        <th class="pb-3 fw-medium">Actions</th>
      </tr>
    </thead>
    <tbody>
      ${data.listed.map(s => `
        <tr>
          <td>
            <div class="d-flex align-items-center gap-2">
              ${
                s.imageUrl
                  ? `<img src="${s.imageUrl}" class="rounded" style="width:40px;height:40px;object-fit:cover;">`
                  : `<div class="rounded bg-light" style="width:40px;height:40px;"></div>`
              }
              <span class="text-nowrap">${s.name || 'Unknown'}</span>
            </div>
          </td>
          <td class="text-nowrap">${s.price} ${s.currency}</td>
          <td class="text-nowrap">
            <span class="badge ${
              s.status === 'active'
                ? 'bg-success'
                : s.status === 'sold'
                ? 'bg-primary'
                : 'bg-secondary'
            }">${s.status}</span>
          </td>
          <td class="text-nowrap">
            ${new Date(s.createdAt).toLocaleDateString()}
          </td>
          <td class="text-nowrap">
            ${
              s.status === 'listed'
                ? `<button class="btn btn-sm btn-outline-danger" onclick="cancelSale('${s._id}')">Cancel</button>`
                : '-'
            }
          </td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>
`;
    }

    async function cancelSale(id) {
        try {
            await fetch(`/api/sales/${id}/cancel`, { method: 'PUT' });

            alert("Delisted")
            loadSales();
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to cancel sale', confirmButtonColor: '#5d8df4' });
        }
    }

    async function loadAuctions() {
        try {
            const res = await fetch('/api/auctions/user',{
                credentials:"include"
            });
            const data = await res.json();
            auctions = data.auctions || [];
            renderAuctions(data.stats);
        } catch (err) {
            console.error('Failed to load auctions:', err);
        }
    }

    function renderAuctions(stats) {
        if (stats) {
            const el1 = document.getElementById('auctionStatCreated');
            const el2 = document.getElementById('auctionStatBids');
            const el3 = document.getElementById('auctionStatVolume');
            const el4 = document.getElementById('auctionStatActive');
            if (el1) el1.innerText = stats.total || 0;
            if (el2) el2.innerText = stats.totalBids || 0;
            if (el3) el3.innerText = (stats.totalVolume || 0).toFixed(2) + ' WETH';
            if (el4) el4.innerText = stats.active || 0;
        }
        
        const container = document.getElementById('auctionsList');
        if (!container) return;
        
        if (auctions.length === 0) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                        <i class="bi bi-hammer text-muted"></i>
                    </div>
                    <h5 class="fw-bold">No auctions found</h5>
                    <p class="text-muted mb-0">You don't have any live auctions right now.</p>
                </div>`;
            return;
        }

        container.innerHTML = auctions.map(a => {
            const startDate = new Date(a.startTime);
            const endDate = new Date(a.endTime);
            const now = new Date();
            const isActive = a.status === 'active' || (startDate <= now && endDate > now);
            const isPending = a.status === 'pending' || startDate > now;
            const isEnded = a.status === 'ended' || endDate <= now;
            
            let statusBadge = 'bg-secondary';
            let statusText = a.status;
            if (isActive && !isEnded) {
                statusBadge = 'bg-success';
                statusText = 'active';
            } else if (isPending && !isEnded) {
                statusBadge = 'bg-warning text-dark';
                statusText = 'pending';
            } else if (isEnded) {
                statusBadge = 'bg-secondary';
                statusText = 'ended';
            }
            
            return `
            <div class="vx-card mb-3">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                    <div class="d-flex align-items-center gap-3">
                        ${a.nft?.imageUrl ? `<img src="${a.nft.imageUrl}" class="rounded" style="width: 60px; height: 60px; object-fit: cover;">` : '<div class="rounded bg-light d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="bi bi-hammer text-muted"></i></div>'}
                        <div>
                            <h6 class="fw-bold mb-1">${a.nft?.name || 'Unknown NFT'}</h6>
                            <span class="badge ${statusBadge}">${statusText}</span>
                        </div>
                    </div>
                    <div class="d-flex flex-column align-items-end gap-1">
                        <p class="mb-0 fw-bold">${a.currentBid || a.startingPrice} ${a.currency}</p>
                        <small class="text-muted">${a.bids?.length || 0} bids</small>
                    </div>
                </div>
                <div class="mt-3 pt-3 border-top">
                    <div class="row g-2 text-center">
                        <div class="col-6">
                            <small class="text-muted d-block">Start Time</small>
                            <span class="small fw-medium">${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">End Time</small>
                            <span class="small fw-medium">${endDate.toLocaleDateString()} ${endDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    async function loadExhibitions() {
        try {
            const res = await fetch('/api/exhibitions/user',{
credentials:"include"
            });
            const data = await res.json();
            exhibitions = data.exhibitions || [];
            renderExhibitions(data.stats);
        } catch (err) {
            console.error('Failed to load exhibitions:', err);
        }
    }

    function renderExhibitions(stats) {
        if (stats) {
            const el1 = document.getElementById('exhibitionStatTotal');
            const el2 = document.getElementById('exhibitionStatActive');
            const el3 = document.getElementById('exhibitionStatViews');
            const el4 = document.getElementById('exhibitionStatLikes');
            if (el1) el1.innerText = stats.total || 0;
            if (el2) el2.innerText = stats.active || 0;
            if (el3) el3.innerText = stats.totalViews || 0;
            if (el4) el4.innerText = stats.totalLikes || 0;
        }
        
        const container = document.getElementById('exhibitionsList');
        const countEl = document.getElementById('exhibitionsCount');
        if (countEl) countEl.innerText = exhibitions.length + ' exhibitions';
        
        if (!container) return;
        
        if (exhibitions.length === 0) {
            container.innerHTML = '';
            return;
        }

        container.innerHTML = exhibitions.map(e => `
            <div class="vx-card mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center gap-3">
                        ${e.thumbnailUrl ? `<img src="${e.thumbnailUrl}" class="rounded" style="width: 60px; height: 60px; object-fit: cover;">` : '<div class="rounded bg-light" style="width: 60px; height: 60px;"></div>'}
                        <div>
                            <h6 class="fw-bold mb-1">${e.title}</h6>
                            <span class="badge ${e.status === 'active' ? 'bg-success' : e.status === 'draft' ? 'bg-warning' : 'bg-secondary'}">${e.status}</span>
                        </div>
                    </div>
                    <div class="text-end">
                        <p class="mb-0"><i class="bi bi-eye me-1"></i>${e.views || 0}</p>
                        <small class="text-muted"><i class="bi bi-heart me-1"></i>${e.likes || 0}</small>
                    </div>
                </div>
            </div>
        `).join('');
    }

    let currentTransactionFilter = 'all';
    
    async function loadTransactions() {
    try {
        const res = await fetch('/api/transactions', {
            credentials: 'include', //  REQUIRED for session cookies
        });

        //  throw ONLY if response is NOT OK
        if (!res.ok) {
            throw new Error(`Failed to fetch transactions (${res.status})`);
        }

        const data = await res.json();
        transactions = data.transactions || [];
        renderTransactions(data.stats);
    } catch (err) {
        console.error('Failed to load transactions:', err);
    }
}

    function renderTransactions(stats) {
        if (stats) {
            const el = document.getElementById('transactionStats');
            if (el) el.innerText = `${stats.total || 0} total transactions`;
        }
        
        // Reset filter to 'all' when loading fresh data
        currentTransactionFilter = 'all';
        document.querySelectorAll('#transactionTabs button').forEach((b, i) => {
            b.classList.toggle('active', i === 0);
        });
        
        // Render with current filter
        const filtered = getFilteredTransactions(currentTransactionFilter);
        renderFilteredTransactions(filtered, currentTransactionFilter);
        
        // Also update dashboard
        renderDashboardTransactions();
    }
    
    function filterTransactions(type, btn) {
        currentTransactionFilter = type;
        
        // Update active tab
        document.querySelectorAll('#transactionTabs button').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');
        
        // Get filtered list
        const filtered = getFilteredTransactions(type);
        renderFilteredTransactions(filtered, type);
    }
    
    function getFilteredTransactions(type) {
        if (type === 'all') return transactions;
        return transactions.filter(t => {
            if (type === 'buy') return t.type === 'purchase' || t.type === 'buy';
            if (type === 'sold') return t.type === 'sold';
            if (type === 'conversion') return t.type === 'conversion';
            return t.type !== 'sale' && t.type !== 'purchase' && t.type !== 'buy' && t.type !== 'conversion';
        });
    }
    
    function renderFilteredTransactions(filtered, type) {
        const container = document.getElementById('transactionsList');
        if (!container) return;
        
        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                        <i class="bi bi-card-list text-muted"></i>
                    </div>
                    <h5 class="fw-bold">No ${type === 'all' ? '' : type} transactions found</h5>
                    <p class="text-muted mb-0">Try adjusting your filters</p>
                </div>`;
            return;
        }
        
        container.innerHTML = `
           <div class="table-responsive">
  <table class="table table-borderless align-middle mb-0 text-nowrap">
    <thead class="text-muted small border-bottom">
      <tr>
        <th class="pb-3 fw-medium">Type</th>
        <th class="pb-3 fw-medium">Description</th>
        <th class="pb-3 fw-medium">Amount</th>
        <th class="pb-3 fw-medium">Date</th>
      </tr>
    </thead>
    <tbody>
      ${filtered.map(t => `
        <tr>
          <td>
            <span class="badge bg-${
              t.type === 'sale'
                ? 'success'
                : t.type === 'purchase'
                ? 'primary'
                : t.type === 'mint'
                ? 'info'
                : 'secondary'
            }">
              ${t.type}
            </span>
          </td>
          <td class="text-truncate" style="max-width: 240px;">
            ${t.description}
          </td>
          <td>
            ${t.amount ? `${t.amount} ${t.currency}` : '-'}
          </td>
          <td>
            ${new Date(t.createdAt).toLocaleDateString()}
          </td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>
`;
    }

    function renderDashboardTransactions() {
        const container = document.getElementById('dashboardTransactions');
        const totalTransacVolume = document.getElementById('totalTransacVolume');
        let transaccounter=0;
     transactions.forEach(transaction => {
  transaccounter += transaction.total || 0;
});


  totalTransacVolume.innerText = transactions.length;

   
       
        if (!container) return;
        
        const recent = transactions.slice(0, 5);
        
        if (recent.length === 0) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="icon-circle bg-light mx-auto mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                        <i class="bi bi-clock-history text-muted"></i>
                    </div>
                    <h5 class="fw-bold">No recent activity</h5>
                    <p class="text-muted mb-4">Your transactions will appear here</p>
                    <button class="btn btn-outline-primary px-4 rounded-pill">Explore Marketplace</button>
                </div>`;
            return;
        }
        
        container.innerHTML = recent.map(t => `
            <div class="d-flex justify-content-between align-items-center py-3 border-bottom">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-circle bg-${t.type === 'sale' ? 'success' : t.type === 'purchase' ? 'primary' : t.type === 'mint' ? 'info' : 'secondary'} bg-opacity-10 text-${t.type === 'sale' ? 'success' : t.type === 'purchase' ? 'primary' : t.type === 'mint' ? 'info' : 'secondary'}" style="width: 40px; height: 40px;">
                        <i class="bi bi-${t.type === 'sale' ? 'graph-up' : t.type === 'purchase' ? 'cart' : t.type === 'mint' ? 'plus-circle' : 'arrow-left-right'}"></i>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0">${t.description}</h6>
                        <small class="text-muted">${new Date(t.createdAt).toLocaleDateString()}</small>
                    </div>
                </div>
                <div class="text-end">
                    <span class="fw-bold">${t.amount ? t.amount + ' ' + t.currency : '-'}</span>
                </div>
            </div>
        `).join('');
    }

    async function createCollection(form) {
        const formData = new FormData(form);
        try {
            const res = await fetch('/api/collections', {
                method: 'POST',
                body: formData
            });
            if (res.ok) {
                closeCreateModal();
                loadCollections();
                Swal.fire({ icon: 'success', title: 'Success', text: 'Collection created successfully!', confirmButtonColor: '#5d8df4' });
            } else {
                const err = await res.json();
                Swal.fire({ icon: 'error', title: 'Error', text: err.message || 'Failed to create collection', confirmButtonColor: '#5d8df4' });
            }
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to create collection', confirmButtonColor: '#5d8df4' });
        }
    }

    async function listNFTForSale(form) {
        const nftId = form.querySelector('[name="nftId"]').value;
        const price = form.querySelector('[name="price"]').value;
        const currency = form.querySelector('[name="currency"]').value;
        
        if (!nftId || !price) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please select an NFT and enter a price', confirmButtonColor: '#5d8df4' });
            return;
        }

        try {
            const res = await fetch('/api/sales', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nftId, price, currency })
            });
            if (res.ok) {
                closeListNFTModal();
                loadSales();
                loadNfts();
                loadDashboardNfts();
                Swal.fire({ icon: 'success', title: 'Success', text: 'NFT listed for sale successfully!', confirmButtonColor: '#5d8df4' });
            } else {
                const err = await res.json();
                Swal.fire({ icon: 'error', title: 'Error', text: err.message || 'Failed to list NFT', confirmButtonColor: '#5d8df4' });
            }
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to list NFT', confirmButtonColor: '#5d8df4' });
        }
    }

    async function createAuction(form) {
        const data = {
            nftId: form.querySelector('[name="nftId"]').value,
            auctionType: form.querySelector('[name="auctionType"]').value,
            startingPrice: form.querySelector('[name="startingPrice"]').value,
            minimumBid: form.querySelector('[name="minimumBid"]').value,
            bidIncrement: form.querySelector('[name="bidIncrement"]').value,
            startTime: form.querySelector('[name="startTime"]').value,
            endTime: form.querySelector('[name="endTime"]').value,
        };

        if (!data.nftId || !data.startingPrice) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please fill in all required fields', confirmButtonColor: '#5d8df4' });
            return;
        }

        try {
            const res = await fetch('/api/auctions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (res.ok) {
                closeCreateAuctionModal();
                loadAuctions();
                Swal.fire({ icon: 'success', title: 'Success', text: 'Auction created successfully!', confirmButtonColor: '#5d8df4' });
            } else {
                const err = await res.json();
                Swal.fire({ icon: 'error', title: 'Error', text: err.message || 'Failed to create auction', confirmButtonColor: '#5d8df4' });
            }
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to create auction', confirmButtonColor: '#5d8df4' });
        }
    }

    async function createExhibition(form) {
        const formData = new FormData(form);
        try {
            const res = await fetch('/api/exhibitions', {
                method: 'POST',
                body: formData,
                credentials:"include"
            });
            if (res.ok) {
                closeCreateExhibitionModal();
                loadExhibitions();
                Swal.fire({ icon: 'success', title: 'Success', text: 'Exhibition created successfully!', confirmButtonColor: '#5d8df4' });
            } else {
                const err = await res.json();
                Swal.fire({ icon: 'error', title: 'Error', text: err.message || 'Failed to create exhibition', confirmButtonColor: '#5d8df4' });
            }
        } catch (err) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to create exhibition', confirmButtonColor: '#5d8df4' });
        }
    }

    // Settings Page Functions
    let userSettings = {
       
    };

    async function loadSettings() {
        try {
            const res = await fetch('/api/settings',{
                credentials:"include"
            });
            if (res.ok) {
                const data = await res.json();
                userSettings = { ...userSettings, ...data };
            }
        } catch (err) {
            console.error('Failed to load settings:', err);
        }

        document.getElementById('settingsFullName').value = userSettings.fullName || " Please input";
        document.getElementById('settingsUsername').value = userSettings.username;
        document.getElementById('usernamePreview').innerText = userSettings.username;
        document.getElementById('settingsBio').value = userSettings.bio || " ";
        document.getElementById('settingsWebsite').value = userSettings.website;
        document.getElementById('settingsTwitter').value = userSettings.twitter;
        document.getElementById('settingsInstagram').value = userSettings.instagram;
        document.getElementById('settingsEmail').value = userSettings.email;

        // Update username preview on input
        document.getElementById('settingsUsername').addEventListener('input', function() {
            document.getElementById('usernamePreview').innerText = this.value || 'username';
        });

        // Update profile avatar
        if (userSettings.profileImage) {
            document.getElementById('profileAvatarDisplay').innerHTML = `
                <img src="${userSettings.profileImage}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                <label for="profileImageUpload" class="profile-avatar-upload">
                    <i class="bi bi-camera"></i>
                </label>
                <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(this)">
            `;
        }

        // Update notification toggles
        updateToggleState('toggleEmailNotifications', userSettings.notifications.email);
        updateToggleState('toggleSalesAlerts', userSettings.notifications.sales);
        updateToggleState('toggleBidAlerts', userSettings.notifications.bids);
        updateToggleState('toggleExhibitionUpdates', userSettings.notifications.exhibitions);
    }

    function updateToggleState(id, isActive) {
        const toggle = document.getElementById(id);
        if (toggle) {
            if (isActive) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }
    }

    function toggleSettingsMenu() {
        const dropdown = document.getElementById('settingsDropdown');
        dropdown.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('settingsDropdown');
        const menuBtn = document.querySelector('.settings-menu-btn');
        if (dropdown && !dropdown.contains(e.target) && !menuBtn.contains(e.target)) {
            dropdown.classList.remove('show');
        }
    });

    function switchSettingsSection(section) {
        // Hide all sections
        document.getElementById('accountSettingsSection').style.display = 'none';
        document.getElementById('changePasswordSection').style.display = 'none';
        document.getElementById('notificationPreferencesSection').style.display = 'none';
        
        // Remove active from all menu items
        document.querySelectorAll('.settings-dropdown-item').forEach(item => item.classList.remove('active'));

        // Show selected section
        if (section === 'account') {
            document.getElementById('accountSettingsSection').style.display = 'block';
            document.querySelectorAll('.settings-dropdown-item')[0].classList.add('active');
        } else if (section === 'password') {
            document.getElementById('changePasswordSection').style.display = 'block';
            document.querySelectorAll('.settings-dropdown-item')[1].classList.add('active');
        } else if (section === 'notifications') {
            document.getElementById('notificationPreferencesSection').style.display = 'block';
            document.querySelectorAll('.settings-dropdown-item')[2].classList.add('active');
        }

        // Close dropdown
        document.getElementById('settingsDropdown').classList.remove('show');
    }

    function togglePasswordVisibility(inputId, icon) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }

    function toggleNotificationSetting(toggle) {
        toggle.classList.toggle('active');
        
        // Save to userSettings
        const id = toggle.id;
        if (id === 'toggleEmailNotifications') userSettings.notifications.email = toggle.classList.contains('active');
        if (id === 'toggleSalesAlerts') userSettings.notifications.sales = toggle.classList.contains('active');
        if (id === 'toggleBidAlerts') userSettings.notifications.bids = toggle.classList.contains('active');
        if (id === 'toggleExhibitionUpdates') userSettings.notifications.exhibitions = toggle.classList.contains('active');
    }

    async function handleProfileImageUpload(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('folder', 'profiles');
            
            try {
                const res = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (res.ok) {
                    const data = await res.json();
                    userSettings.profileImage = data.url;
                    document.getElementById('profileAvatarDisplay').innerHTML = `
                        <img src="${data.url}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                        <label for="profileImageUpload" class="profile-avatar-upload">
                            <i class="bi bi-camera"></i>
                        </label>
                        <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(this)">
                    `;
                    Swal.fire({ icon: 'success', title: 'Success', text: 'Profile picture updated!', confirmButtonColor: '#5d8df4' });
                } else {
                    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to upload image', confirmButtonColor: '#5d8df4' });
                }
            } catch (err) {
                console.error('Upload error:', err);
                Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to upload image', confirmButtonColor: '#5d8df4' });
            }
        }
    }

    function shareProfile() {
        const url = window.location.origin + '/user/' + userSettings.username;
        if (navigator.share) {
            navigator.share({
                title: userSettings.fullName + ' - Vaultorx',
                url: url
            });
        } else {
            navigator.clipboard.writeText(url).then(() => {
                Swal.fire({ icon: 'success', title: 'Success', text: 'Profile URL copied to clipboard!', confirmButtonColor: '#5d8df4' });
            });
        }
    }

    async function saveAccountSettings() {
        userSettings.fullName = document.getElementById('settingsFullName').value;
        userSettings.username = document.getElementById('settingsUsername').value;
        userSettings.bio = document.getElementById('settingsBio').value;
        userSettings.website = document.getElementById('settingsWebsite').value;
        userSettings.twitter = document.getElementById('settingsTwitter').value;
        userSettings.instagram = document.getElementById('settingsInstagram').value;
        userSettings.email = document.getElementById('settingsEmail').value;

        try {
            const res = await fetch('/api/settings', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                credentials:"include",
                body: JSON.stringify(userSettings)
            });
            
            if (res.ok) {
                Swal.fire({ icon: 'success', title: 'Success', text: 'Settings saved successfully!', confirmButtonColor: '#5d8df4' });
            } else {
                Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to save settings', confirmButtonColor: '#5d8df4' });
            }
        } catch (err) {
            // Settings stored locally for now
            Swal.fire({ icon: 'success', title: 'Success', text: 'Settings saved!', confirmButtonColor: '#5d8df4' });
        }
    }

    async function updatePassword() {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!currentPassword || !newPassword || !confirmPassword) {
            Swal.fire({
                icon: 'warning',
                title: 'Missing Fields',
                text: 'Please fill in all password fields',
                confirmButtonColor: '#5d8df4'
            });
            return;
        }

        if (newPassword !== confirmPassword) {
            Swal.fire({
                icon: 'error',
                title: 'Mismatch',
                text: 'New passwords do not match',
                confirmButtonColor: '#5d8df4'
            });
            return;
        }

        if (newPassword.length < 8) {
            Swal.fire({
                icon: 'warning',
                title: 'Weak Password',
                text: 'Password must be at least 8 characters',
                confirmButtonColor: '#5d8df4'
            });
            return;
        }

        try {
            const res = await fetch('/api/auth/change-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ currentPassword, newPassword })
            });

            const data = await res.json();

            if (res.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Password Updated',
                    text: 'Your password has been changed successfully',
                    confirmButtonColor: '#5d8df4'
                });
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message || 'Failed to update password',
                    confirmButtonColor: '#5d8df4'
                });
            }
        } catch (err) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to update password. Please try again.',
                confirmButtonColor: '#5d8df4'
            });
        }
    }

    // ===== MINTING WIZARD =====
    let currentMintStep = 1;
    let mintData = {
        mediaType: 'image',
        file: null,
        fileUrl: null,
        fileName: '',
        name: '',
        description: '',
        collectionId: '',
        category: 'Art',
        rarity: 'Common',
        attributes: [],
        listImmediately: false,
        saleType: 'fixed',
        price: 0,
        currency: 'WETH',
        royalty: 5
    };

    function openMintModal() {
        document.getElementById('mintNFTModalOverlay').style.display = 'flex';
        resetMintWizard();
        populateMintCollections();
    }

    function closeMintModal() {
        document.getElementById('mintNFTModalOverlay').style.display = 'none';
        resetMintWizard();
    }

    // ===== DEPOSIT MODAL =====
    const PLATFORM_WALLET = '0xe22a4544493ea404ba336e9e3';
    
    function openDepositModal() {
        document.getElementById('depositModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        document.getElementById('depositModalBody').scrollTop = 0;
        generateDepositQR();
    }
    
    function closeDepositModal() {
        document.getElementById('depositModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
        document.getElementById('depositForm').reset();
    }
    
    function generateDepositQR() {
        const qrContainer = document.getElementById('depositQRCode');
        qrContainer.innerHTML = '';
        
        if (typeof QRCode !== 'undefined') {
            QRCode.toCanvas(PLATFORM_WALLET, { 
                width: 180,
                margin: 2,
                color: { dark: '#000000', light: '#ffffff' }
            }, function(error, canvas) {
                if (error) {
                    console.error('QR generation error:', error);
                    qrContainer.innerHTML = '<div class="text-muted">QR Code unavailable</div>';
                } else {
                    canvas.style.borderRadius = '8px';
                    qrContainer.appendChild(canvas);
                }
            });
        } else {
            qrContainer.innerHTML = '<div class="text-muted small">QR Code loading...</div>';
        }
    }
    
    function copyWalletAddress() {
        const address = document.getElementById('platformWalletAddress').textContent;
        navigator.clipboard.writeText(address).then(() => {
            Swal.fire({ icon: 'success', title: 'Success', text: 'Wallet address copied to clipboard!', confirmButtonColor: '#5d8df4' });
        }).catch(err => {
            console.error('Failed to copy:', err);
        });
    }
    
    async function submitDeposit(event) {
        event.preventDefault();
        
        const amount = document.getElementById('depositAmount').value;
        const currency = document.getElementById('depositCurrency').value;
        const txHash = document.getElementById('depositTxHash').value;
        
        if (!amount || !txHash) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please fill in all required fields', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        try {
            const response = await fetch('/api/deposit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    amount: parseFloat(amount),
                    currency: currency,
                    transactionHash: txHash
                })
            });
            
            const data = await response.json();
            if (!response.ok) throw new Error(data.message || 'Failed to submit deposit');
            
            Swal.fire({ icon: 'success', title: 'Success', text: 'Deposit request submitted successfully! Please wait for admin approval (usually within 24 hours).', confirmButtonColor: '#5d8df4' });
            closeDepositModal();
            loadTransactions();
            loadDashboardStats();
        } catch (err) {
            console.error('Deposit error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to submit deposit request. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }

    // ===== WITHDRAW MODAL =====
    let userBalance = 0;
    let userWethBalance = 0;
    
    function openWithdrawModal() {
        document.getElementById('withdrawModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        document.getElementById('withdrawModalBody').scrollTop = 0;
        loadUserBalances();
        setupWithdrawListeners();
    }
    
    function closeWithdrawModal() {
        document.getElementById('withdrawModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
        document.getElementById('withdrawForm').reset();
        updateWithdrawSummary();
    }
    
    async function loadUserBalances() {
        try {
            const res = await fetch('/api/user/balance');
            if (res.ok) {
                const data = await res.json();
                userBalance = data.balance || 0;
                userWethBalance = data.wethBalance || 0;
                
                // Update all balance displays
                document.getElementById('withdrawAvailableBalance').textContent = userBalance.toFixed(4) + ' ETH';
                document.getElementById('ethBalanceDisplay').textContent = userBalance.toFixed(4);
                document.getElementById('wethBalanceDisplay').textContent = userWethBalance.toFixed(4);
                
                const total = userBalance + userWethBalance;
                document.getElementById('totalBalanceETH').textContent = total.toFixed(4);
                // Assuming $3000 per ETH for display
                document.getElementById('totalBalanceUSD').textContent = '$' + (total * 3000).toFixed(2);
                
                // Update convert modal displays if open
                const convertAvailableWeth = document.getElementById('convertAvailableWeth');
                const convertCurrentEth = document.getElementById('convertCurrentEth');
                if (convertAvailableWeth) convertAvailableWeth.textContent = userWethBalance.toFixed(4) + ' WETH';
                if (convertCurrentEth) convertCurrentEth.textContent = userBalance.toFixed(4) + ' ETH';
            }
        } catch (err) {
            console.error('Failed to load balances:', err);
        }
    }
    
    // ===== CONVERT WETH TO ETH MODAL =====
    function openConvertModal() {
        document.getElementById('convertModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadUserBalances();
        setupConvertListeners();
    }
    
    function closeConvertModal() {
        document.getElementById('convertModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
        document.getElementById('convertForm').reset();
        updateConvertSummary();
    }
    
    function setupConvertListeners() {
        const amountInput = document.getElementById('convertAmount');
        amountInput.removeEventListener('input', updateConvertSummary);
        amountInput.addEventListener('input', updateConvertSummary);
    }
    
    function updateConvertSummary() {
        const amount = parseFloat(document.getElementById('convertAmount').value) || 0;
        const fee = amount * 0.15;
        const receive = amount; // Net ETH after 15% fee deduction
        
        document.getElementById('convertSummaryAmount').textContent = amount.toFixed(4) + ' WETH';
        document.getElementById('convertFeeAmount').textContent = '-' + fee.toFixed(4) + ' ETH';
        document.getElementById('convertReceiveAmount').textContent = receive.toFixed(4) + ' ETH';
    }
    
    function setMaxConvert() {
        document.getElementById('convertAmount').value = userWethBalance;
        updateConvertSummary();
    }
    
    async function submitConvert(event) {
        event.preventDefault();
        
        const amount = parseFloat(document.getElementById('convertAmount').value);
        const fee = amount * 0.15;
        
        if (!amount || amount <= 0) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please enter a valid amount', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        if (amount > userWethBalance) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Insufficient WETH balance', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        if (fee > userBalance) {
            Swal.fire({ icon: 'error', title: 'Insufficient ETH', text: `You need ${fee.toFixed(4)} ETH to cover the 15% conversion fee, but you only have ${userBalance.toFixed(4)} ETH.`, confirmButtonColor: '#5d8df4' });
            return;
        }
        
        try {
            const response = await fetch('/api/user/convert-weth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount })
            });
            
            const data = await response.json();
            if (!response.ok) throw new Error(data.message || 'Failed to convert');
            
            Swal.fire({ 
                icon: 'success', 
                title: 'Conversion Complete!', 
                html: `<p>Successfully converted <strong>${amount.toFixed(4)} WETH</strong> to <strong>${data.netAmount.toFixed(4)} ETH</strong>.</p><p class="text-muted small">Fee: ${data.fee.toFixed(4)} ETH (15%)</p>`,
                confirmButtonColor: '#5d8df4' 
            });
            closeConvertModal();
            loadUserBalances();
            loadTransactions();
            loadDashboardStats();
        } catch (err) {
            console.error('Convert error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: err.message || 'Failed to complete conversion. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    // ===== DEPOSIT/WITHDRAWAL HISTORY MODALS =====
    function openDepositHistoryModal() {
        document.getElementById('depositHistoryModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadDepositHistory();
    }
    
    function closeDepositHistoryModal() {
        document.getElementById('depositHistoryModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }
    
    async function loadDepositHistory() {
        try {
            const res = await fetch('/api/user/deposits');
            if (!res.ok) throw new Error('Failed to load');
            const deposits = await res.json();
            
            const container = document.getElementById('depositHistoryList');
            if (deposits.length === 0) {
                container.innerHTML = '<div class="text-center text-muted py-4"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No deposit history</div>';
                return;
            }
            
            container.innerHTML = deposits.map(d => `
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                    <div>
                        <strong>${d.amount} ${d.currency}</strong>
                        <div class="text-muted small">${new Date(d.createdAt).toLocaleString()}</div>
                        ${d.transactionHash ? `<div class="text-muted small text-truncate" style="max-width: 200px;">Tx: ${d.transactionHash}</div>` : ''}
                    </div>
                    <span class="badge ${d.status === 'approved' ? 'bg-success' : d.status === 'declined' ? 'bg-danger' : 'bg-warning'}">${d.status}</span>
                </div>
            `).join('');
        } catch (err) {
            document.getElementById('depositHistoryList').innerHTML = '<div class="text-danger">Failed to load history</div>';
        }
    }
    
    function openWithdrawHistoryModal() {
        document.getElementById('withdrawHistoryModalOverlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadWithdrawHistory();
    }
    
    function closeWithdrawHistoryModal() {
        document.getElementById('withdrawHistoryModalOverlay').style.display = 'none';
        document.body.style.overflow = '';
    }
    
    async function loadWithdrawHistory() {
        try {
            const res = await fetch('/api/user/withdrawals');
            if (!res.ok) throw new Error('Failed to load');
            const withdrawals = await res.json();
            
            const container = document.getElementById('withdrawHistoryList');
            if (withdrawals.length === 0) {
                container.innerHTML = '<div class="text-center text-muted py-4"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No withdrawal history</div>';
                return;
            }
            
            container.innerHTML = withdrawals.map(w => `
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                    <div>
                        <strong>${w.amount} ${w.currency}</strong>
                        <div class="text-muted small">${new Date(w.createdAt).toLocaleString()}</div>
                        ${w.walletAddress ? `<div class="text-muted small text-truncate" style="max-width: 200px;">To: ${w.walletAddress}</div>` : ''}
                    </div>
                    <span class="badge ${w.status === 'approved' ? 'bg-success' : w.status === 'declined' ? 'bg-danger' : 'bg-warning'}">${w.status}</span>
                </div>
            `).join('');
        } catch (err) {
            document.getElementById('withdrawHistoryList').innerHTML = '<div class="text-danger">Failed to load history</div>';
        }
    }
    
    function setupWithdrawListeners() {
        const amountInput = document.getElementById('withdrawAmount');
        const currencySelect = document.getElementById('withdrawCurrency');
        
        amountInput.removeEventListener('input', updateWithdrawSummary);
        currencySelect.removeEventListener('change', updateWithdrawSummary);
        
        amountInput.addEventListener('input', updateWithdrawSummary);
        currencySelect.addEventListener('change', updateWithdrawSummary);
    }
    
    function updateWithdrawSummary() {
        const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
        const currency = document.getElementById('withdrawCurrency').value;
        const fee = 0.001;
        const receive = Math.max(0, amount - fee);
        
        document.getElementById('withdrawSummaryAmount').textContent = amount.toFixed(4) + ' ' + currency;
        document.getElementById('withdrawReceiveAmount').textContent = receive.toFixed(4) + ' ' + currency;
    }
    
    function setMaxWithdraw() {
        document.getElementById('withdrawAmount').value = userBalance;
        updateWithdrawSummary();
    }
    
    async function submitWithdraw(event) {
        event.preventDefault();
        
        const wallet = document.getElementById('withdrawWallet').value;
        const amount = parseFloat(document.getElementById('withdrawAmount').value);
        const currency = document.getElementById('withdrawCurrency').value;
        const network = document.getElementById('withdrawNetwork').value;
        
        if (!wallet || !amount || !network) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please fill in all required fields', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        if (amount > userBalance) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Insufficient balance for this withdrawal', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        if (amount <= 0.001) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Withdrawal amount must be greater than the network fee (0.001 ETH)', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        try {
            const response = await fetch('/api/withdrawal', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials:"include",
                body: JSON.stringify({
                    type: 'withdrawal',
                    description: `Withdrawal request to ${wallet.substring(0, 10)}... on ${network}`,
                    amount: amount,
                    currency: currency,
                    toAddress: wallet,
                    network: network,
                    status: 'pending'
                })
            });
            
            if (!response.ok) throw new Error('Failed to submit withdrawal');
            
            Swal.fire({ icon: 'success', title: 'Success', text: 'Withdrawal request submitted successfully! Processing typically takes 24-48 hours.', confirmButtonColor: '#5d8df4' });
            closeWithdrawModal();
            loadTransactions();
            loadDashboardStats();
        } catch (err) {
            console.error('Withdrawal error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to submit withdrawal request. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }

    function resetMintWizard() {
        currentMintStep = 1;
        mintData = {
            mediaType: 'image',
            file: null,
            fileUrl: null,
            fileName: '',
            name: '',
            description: '',
            collectionId: '',
            category: 'Art',
            rarity: 'Common',
            attributes: [],
            listImmediately: false,
            saleType: 'fixed',
            price: 0,
            currency: 'WETH',
            royalty: 5
        };
        updateMintStepUI();
        clearUpload();
        document.getElementById('mintNftName').value = '';
        document.getElementById('mintNftDescription').value = '';
        document.getElementById('mintNftCollection').value = '';
        document.getElementById('mintNftCategory').value = 'Art';
        document.getElementById('attributesContainer').innerHTML = '';
        document.getElementById('listImmediately').checked = false;
        document.getElementById('pricingOptions').style.display = 'none';
        document.getElementById('mintPrice').value = '';
        document.getElementById('mintRoyaltySlider').value = 5;
        document.getElementById('mintRoyaltyValue').innerText = '5%';
        document.getElementById('mintRoyaltyPercent').innerText = '5';
        document.getElementById('agreeTerms').checked = false;
        document.getElementById('termsError').style.display = 'none';
        
        document.querySelectorAll('.rarity-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector('.rarity-option').classList.add('active');
        
        document.querySelectorAll('.sale-type-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector('.sale-type-option').classList.add('active');
        
        document.querySelectorAll('.media-type-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.media-type-btn[data-type="image"]').classList.add('active');
    }

    function populateMintCollections() {
        const select = document.getElementById('mintNftCollection');
        select.innerHTML = '<option value="">No Collection</option>';
        collections.forEach(c => {
            select.innerHTML += `<option value="${c._id}">${c.name}</option>`;
        });
    }

    function updateMintStepUI() {
        // Scroll modal to top when changing steps
        const modalBody = document.querySelector('#mintModal .modal-body');
        if (modalBody) modalBody.scrollTop = 0;
        
        document.querySelectorAll('.mint-step').forEach((step, index) => {
            const stepNum = index + 1;
            step.classList.remove('active', 'completed');
            if (stepNum < currentMintStep) {
                step.classList.add('completed');
            } else if (stepNum === currentMintStep) {
                step.classList.add('active');
            }
        });

        document.querySelectorAll('.mint-step-content').forEach((content, index) => {
            content.classList.remove('active');
            if (index + 1 === currentMintStep) {
                content.classList.add('active');
            }
        });

        const backBtn = document.getElementById('mintBackBtn');
        const nextBtn = document.getElementById('mintNextBtn');
        const submitBtn = document.getElementById('mintSubmitBtn');
        const footer = document.getElementById('mintFooter');

        if (currentMintStep === 1) {
            backBtn.style.display = 'none';
        } else {
            backBtn.style.display = 'inline-flex';
        }

        if (currentMintStep === 4) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'inline-flex';
        } else if (currentMintStep === 5) {
            footer.style.display = 'none';
        } else {
            nextBtn.style.display = 'inline-flex';
            submitBtn.style.display = 'none';
            footer.style.display = 'flex';
        }
    }

    function nextMintStep() {
        if (!validateMintStep(currentMintStep)) return;
        
        if (currentMintStep === 3) {
            updateReviewStep();
        }
        
        currentMintStep++;
        updateMintStepUI();
    }

    function prevMintStep() {
        currentMintStep--;
        updateMintStepUI();
    }

    function validateMintStep(step) {
        if (step === 1) {
            if (!mintData.file) {
                Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please upload a file to continue', confirmButtonColor: '#5d8df4' });
                return false;
            }
        } else if (step === 2) {
            const name = document.getElementById('mintNftName').value.trim();
            if (!name) {
                Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please enter an NFT name', confirmButtonColor: '#5d8df4' });
                return false;
            }
            mintData.name = name;
            mintData.description = document.getElementById('mintNftDescription').value;
            mintData.collectionId = document.getElementById('mintNftCollection').value;
            mintData.category = document.getElementById('mintNftCategory').value;
            mintData.rarity = document.querySelector('input[name="mintRarity"]:checked').value;
            
            const attrRows = document.querySelectorAll('.attribute-row');
            mintData.attributes = [];
            attrRows.forEach(row => {
                const type = row.querySelector('input:first-child').value.trim();
                const value = row.querySelector('input:last-of-type').value.trim();
                if (type && value) {
                    mintData.attributes.push({ trait_type: type, value });
                }
            });
        } else if (step === 3) {
            mintData.listImmediately = document.getElementById('listImmediately').checked;
            mintData.saleType = document.querySelector('input[name="saleType"]:checked').value;
            mintData.price = parseFloat(document.getElementById('mintPrice').value) || 0;
            mintData.currency = document.getElementById('mintCurrency').value;
            mintData.royalty = parseInt(document.getElementById('mintRoyaltySlider').value);
            
            if (mintData.listImmediately && mintData.price <= 0) {
                Swal.fire({ icon: 'warning', title: 'Warning', text: 'Please enter a valid price', confirmButtonColor: '#5d8df4' });
                return false;
            }
        }
        return true;
    }

    function updateReviewStep() {
        document.getElementById('reviewNftName').innerText = mintData.name;
        document.getElementById('reviewNftCategory').innerText = mintData.category;
        document.getElementById('reviewDetailName').innerText = mintData.name;
        document.getElementById('reviewDetailFile').innerText = mintData.fileName;
        document.getElementById('reviewDetailAttributes').innerText = mintData.attributes.length;
        
        const listBadge = document.getElementById('reviewListImmediate');
        if (mintData.listImmediately) {
            listBadge.className = 'badge bg-success';
            listBadge.innerText = 'Yes';
        } else {
            listBadge.className = 'badge bg-secondary';
            listBadge.innerText = 'No';
        }
        
        document.getElementById('reviewSaleType').innerText = mintData.saleType === 'fixed' ? 'Fixed Price' : 'Timed Auction';
        document.getElementById('reviewPrice').innerText = mintData.listImmediately ? `${mintData.price} ${mintData.currency}` : '-';
        document.getElementById('reviewRoyalty').innerText = mintData.royalty + '%';
        
        const previewMedia = document.getElementById('reviewPreviewMedia');
        if (mintData.fileUrl) {
            if (mintData.mediaType === 'video') {
                previewMedia.innerHTML = `<video src="${mintData.fileUrl}" muted loop autoplay></video>`;
            } else if (mintData.mediaType === 'audio') {
                previewMedia.innerHTML = `<i class="bi bi-music-note-beamed"></i>`;
            } else {
                previewMedia.innerHTML = `<img src="${mintData.fileUrl}" alt="Preview">`;
            }
        }
    }

    function selectMediaType(type) {
        mintData.mediaType = type;
        document.querySelectorAll('.media-type-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.type === type) btn.classList.add('active');
        });
        
        const fileInput = document.getElementById('mintFileInput');
        if (type === 'image') {
            fileInput.accept = 'image/jpeg,image/png,image/svg+xml';
        } else if (type === 'gif') {
            fileInput.accept = 'image/gif';
        } else if (type === 'video') {
            fileInput.accept = 'video/mp4,video/webm';
        } else if (type === 'audio') {
            fileInput.accept = 'audio/mp3,audio/wav,audio/mpeg';
        }
        
        clearUpload();
    }

    function handleDragOver(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('mintUploadZone').classList.add('dragover');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('mintUploadZone').classList.remove('dragover');
    }

    function handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('mintUploadZone').classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            processFile(files[0]);
        }
    }

    function handleFileSelect(input) {
        if (input.files && input.files[0]) {
            processFile(input.files[0]);
        }
    }

    function processFile(file) {
        const maxSize = 50 * 1024 * 1024; // 50MB
        if (file.size > maxSize) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'File size exceeds 50MB limit', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        mintData.file = file;
        mintData.fileName = file.name;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            mintData.fileUrl = e.target.result;
            showUploadPreview(file, e.target.result);
        };
        reader.readAsDataURL(file);
    }

    function showUploadPreview(file, dataUrl) {
        const uploadContent = document.getElementById('uploadContent');
        const uploadPreview = document.getElementById('uploadPreview');
        const previewContainer = document.getElementById('previewContainer');
        const fileName = document.getElementById('uploadedFileName');
        
        uploadContent.style.display = 'none';
        uploadPreview.style.display = 'block';
        document.getElementById('mintUploadZone').classList.add('has-file');
        
        fileName.innerText = file.name;
        
        if (file.type.startsWith('image/')) {
            previewContainer.innerHTML = `<img src="${dataUrl}" alt="Preview">`;
        } else if (file.type.startsWith('video/')) {
            previewContainer.innerHTML = `<video src="${dataUrl}" controls style="max-width: 200px; max-height: 200px;"></video>`;
        } else if (file.type.startsWith('audio/')) {
            previewContainer.innerHTML = `
                <div class="text-center">
                    <i class="bi bi-music-note-beamed fs-1 text-primary mb-2"></i>
                    <audio src="${dataUrl}" controls class="audio-preview"></audio>
                </div>`;
        }
    }

    function clearUpload() {
        mintData.file = null;
        mintData.fileUrl = null;
        mintData.fileName = '';
        
        document.getElementById('uploadContent').style.display = 'block';
        document.getElementById('uploadPreview').style.display = 'none';
        document.getElementById('previewContainer').innerHTML = '';
        document.getElementById('uploadedFileName').innerText = '';
        document.getElementById('mintUploadZone').classList.remove('has-file');
        document.getElementById('mintFileInput').value = '';
    }

    function addAttribute() {
        const container = document.getElementById('attributesContainer');
        const row = document.createElement('div');
        row.className = 'attribute-row';
        row.innerHTML = `
            <input type="text" class="form-control-custom" placeholder="Type (e.g. Color)">
            <input type="text" class="form-control-custom" placeholder="Value (e.g. Blue)">
            <button type="button" class="btn btn-outline-danger btn-sm" onclick="this.parentElement.remove()">
                <i class="bi bi-trash"></i>
            </button>
        `;
        container.appendChild(row);
    }

    function togglePricingOptions() {
        const checked = document.getElementById('listImmediately').checked;
        document.getElementById('pricingOptions').style.display = checked ? 'block' : 'none';
    }

    function toggleSaleType() {
        document.querySelectorAll('.sale-type-option').forEach(opt => {
            const radio = opt.querySelector('input');
            if (radio.checked) {
                opt.classList.add('active');
            } else {
                opt.classList.remove('active');
            }
        });
    }

    function selectRarity(label) {
        document.querySelectorAll('.rarity-option').forEach(opt => opt.classList.remove('active'));
        label.classList.add('active');
        label.querySelector('input').checked = true;
    }

    function updateMintRoyalty(value) {
        document.getElementById('mintRoyaltyValue').innerText = value + '%';
        document.getElementById('mintRoyaltyPercent').innerText = value;
    }


    async function submitMint() {

        


function getSelectedTags() {
  return [...document.querySelectorAll('.mint-tag.active')]
    .map(tag => tag.textContent);
}
var constet=getSelectedTags()
console.log(constet);


        if (!document.getElementById('agreeTerms').checked) {
            document.getElementById('termsError').style.display = 'block';
            return;
        }
        document.getElementById('termsError').style.display = 'none';
        
        try {
            // First upload the file
            const formData = new FormData();
            formData.append('file', mintData.file);
            formData.append('folder', 'nfts');
            
            const uploadRes = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });
            
            if (!uploadRes.ok) {
                throw new Error('Failed to upload file');
            }
            
            const uploadData = await uploadRes.json();
            var tagtest=getSelectedTags()
            console.log(tagtest);
            
            // Create the NFT
            const nftData = {
                name: mintData.name,
                description: mintData.description,
                imageUrl: uploadData.url,
                mediaType: mintData.mediaType,
                collectionId: mintData.collectionId || null,
                category: mintData.category,
                rarity: mintData.rarity,
                attributes: mintData.attributes,
                tags: getSelectedTags(),
                royalty: mintData.royalty
            };
            
            const nftRes = await fetch('/api/nfts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(nftData)
            });
            
            if (!nftRes.ok) {
                throw new Error('Failed to create NFT');
            }
            
            const nftResult = await nftRes.json();
            
            // If listing immediately, create a sale
            if (mintData.listImmediately && mintData.price > 0) {
                const saleData = {
                    nftId: nftResult._id,
                    price: mintData.price,
                    currency: mintData.currency
                };
                
                await fetch('/api/sales', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(saleData)
                });
            }
            
            // Create a mint transaction
            await fetch('/api/transactions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials:"include",
                body: JSON.stringify({
                    type: 'mint',
                    description: `Minted ${mintData.name}`,
                    nftId: nftResult._id,
                    amount: 0.2,
                    currency: 'ETH',
                    status: 'completed'
                })
            });
            
            // Show success
            currentMintStep = 5;
            updateMintStepUI();
            
            document.getElementById('successPreview').innerHTML = `
                <div class="preview-media mx-auto mb-3">
                    ${mintData.mediaType === 'video' ? 
                        `<video src="${mintData.fileUrl}" muted loop autoplay></video>` :
                        mintData.mediaType === 'audio' ?
                        `<i class="bi bi-music-note-beamed"></i>` :
                        `<img src="${mintData.fileUrl}" alt="${mintData.name}">`
                    }
                </div>
                <h6 class="fw-bold">${mintData.name}</h6>
            `;
            
            // Refresh data
            loadCollections();
            loadNFTsForSelect();
            loadTransactions();
            loadDashboardStats();
            
        } catch (err) {
            console.error('Minting error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to mint NFT: ' + err.message, confirmButtonColor: '#5d8df4' });
        }
    }

    function viewMintedNFT() {
        closeMintModal();
        showPage('collection');
    }

    function mintAnother() {
        resetMintWizard();
    }

    // ===== AUTHENTICATION =====
    let pendingVerificationEmail = '';
    
    function showAuthPage(page) {
        document.getElementById('authContainer').style.display = 'block';
        document.querySelector('.sidebar').style.display = 'none';
        document.querySelector('.main-content').style.display = 'none';
        
        document.getElementById('loginPage').style.display = page === 'login' ? 'block' : 'none';
        document.getElementById('signupPage').style.display = page === 'signup' ? 'block' : 'none';
        document.getElementById('verifyPage').style.display = page === 'verify' ? 'block' : 'none';
    }
    
    function showDashboard() {
        document.getElementById('authContainer').style.display = 'none';
        document.querySelector('.sidebar').style.display = 'flex';
        document.querySelector('.main-content').style.display = 'block';
    }
    
    function togglePasswordVisibility(inputId, btn) {
        const input = document.getElementById(inputId);
        const icon = btn.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }
    
    async function handleLogin(event) {
        event.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                 credentials: 'include', //  This is required for cookies
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (data.needsVerification) {
                pendingVerificationEmail = data.email;
                document.getElementById('verifyEmailDisplay').textContent = data.email;
                showAuthPage('verify');
                return;
            }
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Login failed', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            showDashboard();
            loadDashboardStats();
        } catch (err) {
            console.error('Login error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to login. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    async function handleSignup(event) {
        event.preventDefault();
        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;
        
        if (password !== confirmPassword) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Passwords do not match', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        if (password.length < 6) {
            Swal.fire({ icon: 'warning', title: 'Warning', text: 'Password must be at least 6 characters', confirmButtonColor: '#5d8df4' });
            return;
        }
        
        try {
            const response = await fetch('/api/auth/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password, username })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Signup failed', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            pendingVerificationEmail = data.email;
            document.getElementById('verifyEmailDisplay').textContent = data.email;
            document.getElementById('verifyCodeSent').style.display = 'block';
            showAuthPage('verify');
        } catch (err) {
            console.error('Signup error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to create account. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    async function handleVerify(event) {
        event.preventDefault();
        const code = document.getElementById('verificationCode').value;
        
        try {
            const response = await fetch('/api/auth/verify-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: pendingVerificationEmail, code })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Verification failed', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            Swal.fire({ icon: 'success', title: 'Success', text: 'Email verified successfully! Welcome to Vaultorx.', confirmButtonColor: '#5d8df4' });
            showDashboard();
            loadDashboardStats();
        } catch (err) {
            console.error('Verify error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to verify email. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    async function resendCode() {
        try {
            const response = await fetch('/api/auth/resend-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: pendingVerificationEmail })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                Swal.fire({ icon: 'error', title: 'Error', text: data.message || 'Failed to resend code', confirmButtonColor: '#5d8df4' });
                return;
            }
            
            document.getElementById('verifyCodeSent').style.display = 'block';
            setTimeout(() => {
                document.getElementById('verifyCodeSent').style.display = 'none';
            }, 3000);
        } catch (err) {
            console.error('Resend error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to resend code. Please try again.', confirmButtonColor: '#5d8df4' });
        }
    }
    
    async function logout() {
        try {
            await fetch('/api/auth/logout', { method: 'POST' });
            showAuthPage('login');
        } catch (err) {
            console.error('Logout error:', err);
            showAuthPage('login');
        }
    }
    
    async function checkAuthStatus() {
        try {
            const response = await fetch('/api/auth/session');
            const data = await response.json();
            
            if (data.authenticated) {
                showDashboard();
                loadDashboardStats();
            } else {
                showAuthPage('login');
            }
        } catch (err) {
            console.error('Auth check error:', err);
            showAuthPage('login');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        checkAuthStatus();
    });
</script>
</body>
</html>